!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);class o{static setup(){o.peerConnStack=new Array(0),o.activeConn=0,void 0!==window.Peer&&(o.peerjs=window.Peer),n.KikuAudioStream.setup(),n.KikuAudioStream.listenForStart(o.onStartRecording)}static connectToServer(e,t,r,n){o.myname=e,o.serverAddr=t,o.serverPort=r,o.serverPath=n;let i={host:o.serverAddr,port:o.serverPort,path:o.serverPath};o.peer=new o.peerjs(o.myname,i),o.peer.on("connection",e=>{o.onConnectionCallback(e),e.on("data",t=>{o.onDataCallback(e,t)})})}static connectToDevice(e){let t=o.peer.connect(e);t.on("open",()=>{t.on("data",e=>{o.onDataCallback(t,e)})}),o.peerConnStack.push(t)}static sendEmptyResponse(e){let t=o.findIndexOfDevice(e);if(-1!==t){let e=new a(c.REQUEST_EMPTY_RESPONSE);o.peerConnStack[t].open?(o.ourNetworkTime=o.currentTime(),i.sendData(o.peerConnStack[t],e)):console.warn("Connection to peer was not open to send the data via!")}else console.warn("No peer with that ID was found in the active connection stack!")}static async startRecording(e,t){o.currentMaster=!0,o.inRecordingFlight=!0,o.activeConn=o.findIndexOfDevice(e);let r=performance.timeOrigin+performance.now()+t,s=o.findIndexOfDevice(e);if(-1!==s){let e=new a(c.REQUEST_RECORD,r);console.log("Sending start record message",e),o.peerConnStack[s].open?i.sendData(o.peerConnStack[s],e):console.warn("Connection to peer was not open to send the data via!")}else console.warn("No peer with that ID was found in the active connection stack!");let d=await n.KikuAudioStream.recordAt(r,o.recordDuration);return o.ourBuffer=d,o.currentMaster=!1,new Promise((e,t)=>{setTimeout(()=>{if(o.inRecordingFlight)t("Recording was still in flight and was not transfered back to this device in time");else{let t={currentDeviceBuffer:o.ourBuffer,requestedDeviceBuffer:o.theirBuffer,recordingDelay:o.recordingDelayTime,networkDelay:o.networkDelayTime};e(t)}},o.flightAllowanceTime)})}static sendRecordedBuffer(e,t){let r=o.findIndexOfDevice(e);if(-1!==r){let e=new a(c.RESPONSE_RECORD,o.currentTime(),t);o.peerConnStack[r].open?i.sendData(o.peerConnStack[r],e):console.warn("Connection to peer was not open to send the data via!")}else console.warn("No peer with that ID was found in the active connection stack!")}static onStartRecording(){if(!0!==o.currentMaster){console.log("onStartRecording entering send message"),o.ourRecordingStart=o.currentTime();let e=new a(c.STARTED_RECORDING);o.peerConnStack[o.activeConn].open?(console.log("Sending message of start recording",e),i.sendData(o.peerConnStack[o.activeConn],e)):console.warn("Connection to peer was not open to send the data via!")}}static setReturnAllowance(e){o.flightAllowanceTime=e}static deleteUnusedConnections(){for(let e=0;e<o.peerConnStack.length;e++)o.peerConnStack[e].open||o.peerConnStack.splice(e,1)}static findIndexOfDevice(e){for(var t=0;t<o.peerConnStack.length;t++)if(o.peerConnStack[t].peer===e)return t;return-1}static onDataCallback(e,t){switch(console.log("message received:",t),t.type){case c.REQUEST_EMPTY_RESPONSE:let r=new a(c.RESPONSE_EMPTY_RESPONSE);o.ourNetworkTime=o.currentTime(),i.sendData(e,r);break;case c.REQUEST_RECORD:console.log("Asked to start recording..."),n.KikuAudioStream.recordAt(t.timeStamp,o.recordDuration).then(t=>{console.log("Successfully completed recording!"),this.sendRecordedBuffer(e.peer,t)});break;case c.STARTED_RECORDING:o.theirRecordingStart=o.currentTime(),o.updateRecordingDelayTime();break;case c.RESPONSE_EMPTY_RESPONSE:o.theirNetworkTime=o.currentTime(),o.updateNetworkDelayTime();break;case c.RESPONSE_RECORD:o.theirBuffer=t.audioBuffer,o.inRecordingFlight=!1}}static onConnectionCallback(e){console.log("Connection received!",e),o.peerConnStack.push(e)}static onOpenCallback(){console.log("Connection open!")}static currentTime(){return performance.timing.navigationStart+performance.now()}static updateNetworkDelayTime(){o.ourNetworkTime=o.ourNetworkTime||performance.now(),o.theirNetworkTime=o.theirNetworkTime||o.ourNetworkTime,o.networkDelayTime=Math.abs(o.ourNetworkTime-o.theirNetworkTime)/2}static updateRecordingDelayTime(){o.recordingDelayTime=Math.abs(o.ourRecordingStart-o.theirRecordingStart)/2}}o.activeConn=0,o.flightAllowanceTime=1e3,o.networkDelayTime=10,o.recordingDelayTime=0,o.ourRecordingStart=o.currentTime(),o.theirRecordingStart=o.currentTime(),o.recordDuration=2500,o.buffersReady=!1,o.ourBuffer=new Float32Array(1),o.theirBuffer=new Float32Array(1),o.inRecordingFlight=!1,o.currentMaster=!1;class i{static sendData(e,t){let r={type:t.type,timeStamp:t.timeStamp||"",audioBuffer:t.audioBuffer||""};e._open?e.send(r):console.warn("Tried to send message when connection is closed!",r)}}class a{constructor(e,t,r){this.type=e,this.timeStamp=t,this.audioBuffer=r}toObject(){return{messageType:this.type,timeStamp:this.timeStamp||[],audioBuffer:this.audioBuffer||[]}}}var c;!function(e){e.REQUEST_RECORD="requestRecord",e.RESPONSE_RECORD="responseRecord",e.STARTED_RECORDING="startedRecording",e.STOPPED_RECORDING="stoppedRecording",e.REQUEST_EMPTY_RESPONSE="requestEmptyResponse",e.RESPONSE_EMPTY_RESPONSE="responseEmptyResponse"}(c||(c={})),window.Kiku=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{static setup(){n.audioContext=new AudioContext||window.webkitAudioContext(),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(console.log("getUserMedia supported."),navigator.mediaDevices.getUserMedia({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"},optional:[]}}).then(function(e){n.setupStream(e)}).catch(function(e){console.warn("The following getUserMedia error occured: "+e)})):console.warn("getUserMedia not supported on your browser!")}static listenForStart(e){this.startedRecording=e}static listenForEnd(e){this.finishedRecording=e}static float32bufferConcat(e,t){let r=e.length,n=new Float32Array(r+t.length);return n.set(e),n.set(t,r),n}static setupStream(e){n.supported=!0,this.micRecorder=new MediaRecorder(e),n.scriptNode=n.audioContext.createScriptProcessor(1024,1,1),n.mediaStreamSourceNode=n.audioContext.createMediaStreamSource(e),n.scriptNode.onaudioprocess=function(e){n.isRecording?n.activeBuffer=n.float32bufferConcat(n.activeBuffer,e.inputBuffer.getChannelData(0)):!0===n.resetAudioBuffer&&(n.activeBuffer=new Float32Array(1),n.resetAudioBuffer=!1)},n.mediaStreamSourceNode.connect(n.scriptNode),n.scriptNode.connect(n.audioContext.destination)}static async recordAt(e,t){let r=e-n.currentTime();console.log("Starting to record in "+r+" from now ("+r/1e3+")");return await(()=>new Promise(e=>{setTimeout(()=>{n.record(t).then(t=>{e(t)})},r)}))()}static record(e){return new Promise(t=>{n.isRecording=!0,n.startedRecording(),setTimeout(()=>{n.isRecording=!1,n.recordedBuffer=n.activeBuffer,t(n.recordedBuffer)},e)})}static recording(){return n.isRecording}static getLastRecordedBuffer(){return n.recordedBuffer}static currentTime(){return performance.timing.navigationStart+performance.now()}}n.isRecording=!1,n.activeBuffer=new Float32Array(1),n.recordedBuffer=new Float32Array(1),n.startedRecording=(()=>{}),n.finishedRecording=(()=>{}),n.audioContext=new AudioContext,n.supported=!1,n.resetAudioBuffer=!1,t.KikuAudioStream=n}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2tpa3UudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2tpa3VhdWRpb3N0cmVhbS50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImtpa3VhdWRpb3N0cmVhbV8xIiwiS2lrdSIsIltvYmplY3QgT2JqZWN0XSIsInBlZXJDb25uU3RhY2siLCJBcnJheSIsImFjdGl2ZUNvbm4iLCJ1bmRlZmluZWQiLCJ3aW5kb3ciLCJQZWVyIiwicGVlcmpzIiwiS2lrdUF1ZGlvU3RyZWFtIiwic2V0dXAiLCJsaXN0ZW5Gb3JTdGFydCIsIm9uU3RhcnRSZWNvcmRpbmciLCJzZXJ2ZXJBZGRyIiwic2VydmVyUG9ydCIsInNlcnZlclBhdGgiLCJteW5hbWUiLCJzZXJ2ZXJJbmZvIiwiaG9zdCIsInBvcnQiLCJwYXRoIiwicGVlciIsIm9uIiwiY29ubiIsIm9uQ29ubmVjdGlvbkNhbGxiYWNrIiwibWVzc2FnZSIsIm9uRGF0YUNhbGxiYWNrIiwiZGV2aWNlTmFtZSIsInBlZXJDb25uIiwiY29ubmVjdCIsInB1c2giLCJzdGFja0luZGV4IiwiZmluZEluZGV4T2ZEZXZpY2UiLCJNZXNzYWdlRGF0YSIsIk1lc3NhZ2VUeXBlIiwiUkVRVUVTVF9FTVBUWV9SRVNQT05TRSIsIm9wZW4iLCJvdXJOZXR3b3JrVGltZSIsImN1cnJlbnRUaW1lIiwiUGVlckNvbm5lY3Rpb24iLCJzZW5kRGF0YSIsImNvbnNvbGUiLCJ3YXJuIiwiZnJvbU5vdyIsImN1cnJlbnRNYXN0ZXIiLCJpblJlY29yZGluZ0ZsaWdodCIsInRpbWVTdGFtcCIsInBlcmZvcm1hbmNlIiwidGltZU9yaWdpbiIsIm5vdyIsIlJFUVVFU1RfUkVDT1JEIiwibG9nIiwiYnVmZmVyIiwicmVjb3JkQXQiLCJyZWNvcmREdXJhdGlvbiIsIm91ckJ1ZmZlciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwic2V0VGltZW91dCIsInJlc3VsdHMiLCJjdXJyZW50RGV2aWNlQnVmZmVyIiwicmVxdWVzdGVkRGV2aWNlQnVmZmVyIiwidGhlaXJCdWZmZXIiLCJyZWNvcmRpbmdEZWxheSIsInJlY29yZGluZ0RlbGF5VGltZSIsIm5ldHdvcmtEZWxheSIsIm5ldHdvcmtEZWxheVRpbWUiLCJmbGlnaHRBbGxvd2FuY2VUaW1lIiwiUkVTUE9OU0VfUkVDT1JEIiwib3VyUmVjb3JkaW5nU3RhcnQiLCJTVEFSVEVEX1JFQ09SRElORyIsImFsbG93YW5jZSIsImluZGV4IiwibGVuZ3RoIiwic3BsaWNlIiwidHlwZSIsImVtcHR5UmVzcG9uc2UiLCJSRVNQT05TRV9FTVBUWV9SRVNQT05TRSIsInRoZW4iLCJ0aGlzIiwic2VuZFJlY29yZGVkQnVmZmVyIiwidGhlaXJSZWNvcmRpbmdTdGFydCIsInVwZGF0ZVJlY29yZGluZ0RlbGF5VGltZSIsInRoZWlyTmV0d29ya1RpbWUiLCJ1cGRhdGVOZXR3b3JrRGVsYXlUaW1lIiwiYXVkaW9CdWZmZXIiLCJ0aW1pbmciLCJuYXZpZ2F0aW9uU3RhcnQiLCJNYXRoIiwiYWJzIiwiYnVmZmVyc1JlYWR5IiwiRmxvYXQzMkFycmF5IiwibWVzc2FnZURhdGEiLCJfb3BlbiIsInNlbmQiLCJtZXNzYWdlVHlwZSIsImF1ZGlvQ29udGV4dCIsIkF1ZGlvQ29udGV4dCIsIndlYmtpdEF1ZGlvQ29udGV4dCIsIm5hdmlnYXRvciIsIm1lZGlhRGV2aWNlcyIsImdldFVzZXJNZWRpYSIsImF1ZGlvIiwibWFuZGF0b3J5IiwiZ29vZ0VjaG9DYW5jZWxsYXRpb24iLCJnb29nQXV0b0dhaW5Db250cm9sIiwiZ29vZ05vaXNlU3VwcHJlc3Npb24iLCJnb29nSGlnaHBhc3NGaWx0ZXIiLCJvcHRpb25hbCIsInN0cmVhbSIsInNldHVwU3RyZWFtIiwiY2F0Y2giLCJlcnIiLCJjYWxsYmFjayIsInN0YXJ0ZWRSZWNvcmRpbmciLCJmaW5pc2hlZFJlY29yZGluZyIsImJ1ZmZlcjAiLCJidWZmZXIxIiwiaXRlbTBMZW5ndGgiLCJyZXN1bHQiLCJzZXQiLCJzdXBwb3J0ZWQiLCJtaWNSZWNvcmRlciIsIk1lZGlhUmVjb3JkZXIiLCJzY3JpcHROb2RlIiwiY3JlYXRlU2NyaXB0UHJvY2Vzc29yIiwibWVkaWFTdHJlYW1Tb3VyY2VOb2RlIiwiY3JlYXRlTWVkaWFTdHJlYW1Tb3VyY2UiLCJvbmF1ZGlvcHJvY2VzcyIsImV2ZW50IiwiaXNSZWNvcmRpbmciLCJhY3RpdmVCdWZmZXIiLCJmbG9hdDMyYnVmZmVyQ29uY2F0IiwiaW5wdXRCdWZmZXIiLCJnZXRDaGFubmVsRGF0YSIsInJlc2V0QXVkaW9CdWZmZXIiLCJkZXN0aW5hdGlvbiIsInRpbWUiLCJkdXJhdGlvbiIsImV0YV9tcyIsInJlY29yZCIsInJlY29yZGluZyIsIndhaXRVbnRpbCIsInJlY29yZGVkQnVmZmVyIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFFBQUEsSUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVB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RixRQUFVQyxJQUdqQmhELEVBQWdCMEgsYUFBYyxFQUc5QjFILEVBQWdCMEcsbUJBR2hCeEQsV0FBVyxLQUNQbEQsRUFBZ0IwSCxhQUFjLEVBQzlCMUgsRUFBZ0J1SSxlQUFpQnZJLEVBQWdCMkgsYUFDakQzRSxFQUFRaEQsRUFBZ0J1SSxpQkFDekJMLEtBVUoxSSxtQkFDSCxPQUFPUSxFQUFnQjBILFlBUXBCbEksK0JBQ0gsT0FBT1EsRUFBZ0J1SSxlQVFuQi9JLHFCQUNKLE9BQU84QyxZQUFZd0MsT0FBT0MsZ0JBQWtCekMsWUFBWUUsT0E1TnJEeEMsRUFBQTBILGFBQXVCLEVBQ3ZCMUgsRUFBQTJILGFBQTZCLElBQUl4QyxhQUFhLEdBQzlDbkYsRUFBQXVJLGVBQStCLElBQUlwRCxhQUFhLEdBRXpDbkYsRUFBQTBHLGlCQUE2QixTQUM3QjFHLEVBQUEyRyxrQkFBOEIsU0FFckMzRyxFQUFBd0YsYUFBNkIsSUFBSUMsYUFNakN6RixFQUFBaUgsV0FBcUIsRUFFYmpILEVBQUErSCxrQkFBNEIsRUFqQi9DM0ssRUFBQTRDIiwiZmlsZSI6ImxpYmtpa3UubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiaW1wb3J0IHsgS2lrdUF1ZGlvU3RyZWFtIH0gZnJvbSAnLi9raWt1YXVkaW9zdHJlYW0nO1xuXG4vKipcbiAqIEBjbGFzcyBLaWt1XG4gKi9cbmNsYXNzIEtpa3Uge1xuXG4gICAgc3RhdGljIG15bmFtZT86IHN0cmluZztcbiAgICBzdGF0aWMgc2VydmVyQWRkcj86IHN0cmluZztcbiAgICBzdGF0aWMgc2VydmVyUG9ydD86IHN0cmluZztcbiAgICBzdGF0aWMgc2VydmVyUGF0aD86IHN0cmluZztcbiAgICBzdGF0aWMgcGVlcmpzPzogYW55O1xuICAgIHN0YXRpYyBwZWVyPzogYW55O1xuICAgIHN0YXRpYyBwZWVyQ29ublN0YWNrOiBhbnlbXTtcbiAgICBzdGF0aWMgYWN0aXZlQ29ubjogbnVtYmVyID0gMDtcbiAgICBzdGF0aWMgZmxpZ2h0QWxsb3dhbmNlVGltZTogbnVtYmVyID0gMTAwMDtcblxuICAgIHN0YXRpYyBuZXR3b3JrRGVsYXlUaW1lOiBudW1iZXIgPSAxMDtcbiAgICBzdGF0aWMgb3VyTmV0d29ya1RpbWU/OiBudW1iZXI7IFxuICAgIHN0YXRpYyB0aGVpck5ldHdvcmtUaW1lPzogbnVtYmVyOyBcblxuICAgIHN0YXRpYyByZWNvcmRpbmdEZWxheVRpbWU6IG51bWJlciA9IDA7XG4gICAgc3RhdGljIG91clJlY29yZGluZ1N0YXJ0OiBudW1iZXIgPSBLaWt1LmN1cnJlbnRUaW1lKCk7XG4gICAgc3RhdGljIHRoZWlyUmVjb3JkaW5nU3RhcnQ6IG51bWJlciA9IEtpa3UuY3VycmVudFRpbWUoKTtcblxuICAgIHN0YXRpYyByZWNvcmREdXJhdGlvbjogbnVtYmVyID0gMjUwMDtcbiAgICBzdGF0aWMgYnVmZmVyc1JlYWR5OiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBzdGF0aWMgb3VyQnVmZmVyPzogRmxvYXQzMkFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSgxKTtcbiAgICBzdGF0aWMgdGhlaXJCdWZmZXI/OiBGbG9hdDMyQXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KDEpO1xuICAgIHN0YXRpYyBpblJlY29yZGluZ0ZsaWdodDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgc3RhdGljIGN1cnJlbnRNYXN0ZXI6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgc2V0dXBcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgc2V0dXAgKCkge1xuXG4gICAgICAgIEtpa3UucGVlckNvbm5TdGFjayA9IG5ldyBBcnJheSgwKTtcbiAgICAgICAgS2lrdS5hY3RpdmVDb25uID0gMDtcblxuICAgICAgICBpZiAoKDxhbnk+d2luZG93KS5QZWVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIEtpa3UucGVlcmpzID0gKDxhbnk+d2luZG93KS5QZWVyO1xuICAgICAgICB9XG5cbiAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLnNldHVwKCk7XG4gICAgICAgIEtpa3VBdWRpb1N0cmVhbS5saXN0ZW5Gb3JTdGFydChLaWt1Lm9uU3RhcnRSZWNvcmRpbmcpO1xuICAgICAgICBcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGNvbm5lY3RUb1NlcnZlclxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIG5hbWUgOiBOYW1lIG9mIHRoZSBwZWVyIG9uIHRoaXMgZGV2aWNlXG4gICAgICogQHBhcmFtIHNlcnZlckFkZHIgOiBTZXJ2ZXIgSVAgbG9jYXRpb25cbiAgICAgKiBAcGFyYW0gc2VydmVyUG9ydCA6IFNlcnZlciBwb3J0XG4gICAgICogQHBhcmFtIHNlcnZlclBhdGggOiBQZWVyanMgc2VydmVyIHBhdGhcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGNvbm5lY3RUb1NlcnZlciAobmFtZTogc3RyaW5nLCBzZXJ2ZXJBZGRyOiBzdHJpbmcsIHNlcnZlclBvcnQ6IHN0cmluZywgc2VydmVyUGF0aDpzdHJpbmcpIHtcblxuICAgICAgICAvLyBTZXR1cCBwcm9wZXJ0aWVzXG4gICAgICAgIEtpa3UubXluYW1lID0gbmFtZTtcbiAgICAgICAgS2lrdS5zZXJ2ZXJBZGRyID0gc2VydmVyQWRkcjtcbiAgICAgICAgS2lrdS5zZXJ2ZXJQb3J0ID0gc2VydmVyUG9ydDtcbiAgICAgICAgS2lrdS5zZXJ2ZXJQYXRoID0gc2VydmVyUGF0aDtcblxuICAgICAgICAvLyBGb3JtYXQgZm9yIHBlZXJqc1xuICAgICAgICBsZXQgc2VydmVySW5mbzogT2JqZWN0ID0ge1xuICAgICAgICAgICAgaG9zdDogS2lrdS5zZXJ2ZXJBZGRyLFxuICAgICAgICAgICAgcG9ydDogS2lrdS5zZXJ2ZXJQb3J0LFxuICAgICAgICAgICAgcGF0aDogS2lrdS5zZXJ2ZXJQYXRoXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQ29ubmVjdCB0byBzZXJ2ZXJcbiAgICAgICAgS2lrdS5wZWVyID0gbmV3IEtpa3UucGVlcmpzKEtpa3UubXluYW1lLCBzZXJ2ZXJJbmZvKTsgXG5cbiAgICAgICAgLy8gQXNzaWduIGNhbGxiYWNrcyB0byBwZWVyIG9iamVjdFxuICAgICAgICBLaWt1LnBlZXIub24oJ2Nvbm5lY3Rpb24nLCAoY29ubjogYW55KSA9PiB7XG4gICAgICAgICAgICBLaWt1Lm9uQ29ubmVjdGlvbkNhbGxiYWNrKGNvbm4pO1xuICAgICAgICAgICAgY29ubi5vbignZGF0YScsIChtZXNzYWdlOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICBLaWt1Lm9uRGF0YUNhbGxiYWNrKGNvbm4sIG1lc3NhZ2UpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgY29ubmVjdFRvRGV2aWNlXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gZGV2aWNlTmFtZSBcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGNvbm5lY3RUb0RldmljZSAoZGV2aWNlTmFtZTogc3RyaW5nKSB7XG5cbiAgICAgICAgLy8gQ29ubmVjdCB0byBwZWVyXG4gICAgICAgIGxldCBwZWVyQ29ubiA9IEtpa3UucGVlci5jb25uZWN0KGRldmljZU5hbWUpO1xuXG4gICAgICAgIC8vIFNldHVwIGNhbGxiYWNrcyBiZWZvcmUgYWRkaW5nIHRvIHRoZSBzdGFja1xuICAgICAgICBwZWVyQ29ubi5vbignb3BlbicsICgpID0+IHtcbiAgICAgICAgICAgIHBlZXJDb25uLm9uKCdkYXRhJywgKG1lc3NhZ2U6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIEtpa3Uub25EYXRhQ2FsbGJhY2socGVlckNvbm4sIG1lc3NhZ2UpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcblxuICAgICAgICAvLyBBZGQgb250byB0aGUgY29ubmVjdGlvbiBzdGFja1xuICAgICAgICBLaWt1LnBlZXJDb25uU3RhY2sucHVzaChwZWVyQ29ubik7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHNlbmRFbXB0eVJlc3BvbnNlXG4gICAgICogQHBhcmFtIGRldmljZU5hbWUgOiBOYW1lIG9mIGRldmljZSB0byBzZW5kIG1lc3NhZ2UgdG9cbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHNlbmRFbXB0eVJlc3BvbnNlIChkZXZpY2VOYW1lOiBzdHJpbmcpIHtcblxuICAgICAgICBsZXQgc3RhY2tJbmRleCA9IEtpa3UuZmluZEluZGV4T2ZEZXZpY2UoZGV2aWNlTmFtZSk7XG5cbiAgICAgICAgaWYgKHN0YWNrSW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBsZXQgbWVzc2FnZSA9IG5ldyBNZXNzYWdlRGF0YShNZXNzYWdlVHlwZS5SRVFVRVNUX0VNUFRZX1JFU1BPTlNFKTtcbiAgICAgICAgICAgIGlmIChLaWt1LnBlZXJDb25uU3RhY2tbc3RhY2tJbmRleF0ub3Blbil7XG4gICAgICAgICAgICAgICAgS2lrdS5vdXJOZXR3b3JrVGltZSA9IEtpa3UuY3VycmVudFRpbWUoKTtcbiAgICAgICAgICAgICAgICBQZWVyQ29ubmVjdGlvbi5zZW5kRGF0YShLaWt1LnBlZXJDb25uU3RhY2tbc3RhY2tJbmRleF0sIG1lc3NhZ2UpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0Nvbm5lY3Rpb24gdG8gcGVlciB3YXMgbm90IG9wZW4gdG8gc2VuZCB0aGUgZGF0YSB2aWEhJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ05vIHBlZXIgd2l0aCB0aGF0IElEIHdhcyBmb3VuZCBpbiB0aGUgYWN0aXZlIGNvbm5lY3Rpb24gc3RhY2shJyk7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgc3RhcnRSZWNvcmRpbmdcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBkZXZpY2VOYW1lIDogRGV2aWNlIHRvIHJlcXVlc3Qgc3luY2hyb25pemVkIHJlY29yZGluZ1xuICAgICAqIEBwYXJhbSBmcm9tTm93IDogTnVtYmVyIG9mIG1pbGlzZWNvbmRzIHRvIHN0YXJ0IGZyb20gbm93XG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBhc3luYyBzdGFydFJlY29yZGluZyAoZGV2aWNlTmFtZTogc3RyaW5nLCBmcm9tTm93OiBudW1iZXIpIHtcblxuICAgICAgICBLaWt1LmN1cnJlbnRNYXN0ZXIgPSB0cnVlO1xuXG4gICAgICAgIEtpa3UuaW5SZWNvcmRpbmdGbGlnaHQgPSB0cnVlO1xuICAgICAgICBLaWt1LmFjdGl2ZUNvbm4gPSBLaWt1LmZpbmRJbmRleE9mRGV2aWNlKGRldmljZU5hbWUpO1xuXG4gICAgICAgIGxldCB0aW1lU3RhbXAgPSBwZXJmb3JtYW5jZS50aW1lT3JpZ2luICsgcGVyZm9ybWFuY2Uubm93KCkgKyBmcm9tTm93O1xuXG4gICAgICAgIGxldCBzdGFja0luZGV4ID0gS2lrdS5maW5kSW5kZXhPZkRldmljZShkZXZpY2VOYW1lKTtcblxuICAgICAgICBpZiAoc3RhY2tJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gbmV3IE1lc3NhZ2VEYXRhKE1lc3NhZ2VUeXBlLlJFUVVFU1RfUkVDT1JELCB0aW1lU3RhbXApO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1NlbmRpbmcgc3RhcnQgcmVjb3JkIG1lc3NhZ2UnLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIGlmIChLaWt1LnBlZXJDb25uU3RhY2tbc3RhY2tJbmRleF0ub3BlbilcbiAgICAgICAgICAgICAgICBQZWVyQ29ubmVjdGlvbi5zZW5kRGF0YShLaWt1LnBlZXJDb25uU3RhY2tbc3RhY2tJbmRleF0sIG1lc3NhZ2UpO1xuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDb25uZWN0aW9uIHRvIHBlZXIgd2FzIG5vdCBvcGVuIHRvIHNlbmQgdGhlIGRhdGEgdmlhIScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdObyBwZWVyIHdpdGggdGhhdCBJRCB3YXMgZm91bmQgaW4gdGhlIGFjdGl2ZSBjb25uZWN0aW9uIHN0YWNrIScpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGJ1ZmZlciA9IGF3YWl0IEtpa3VBdWRpb1N0cmVhbS5yZWNvcmRBdCh0aW1lU3RhbXAsIEtpa3UucmVjb3JkRHVyYXRpb24pO1xuICAgICAgICBLaWt1Lm91ckJ1ZmZlciA9IDxGbG9hdDMyQXJyYXk+YnVmZmVyO1xuICAgICAgICBLaWt1LmN1cnJlbnRNYXN0ZXIgPSBmYWxzZTtcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UgKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PiB7XG4gICAgICAgICAgICAgICAgaWYgKEtpa3UuaW5SZWNvcmRpbmdGbGlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCdSZWNvcmRpbmcgd2FzIHN0aWxsIGluIGZsaWdodCBhbmQgd2FzIG5vdCB0cmFuc2ZlcmVkIGJhY2sgdG8gdGhpcyBkZXZpY2UgaW4gdGltZScpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCByZXN1bHRzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudERldmljZUJ1ZmZlcjogS2lrdS5vdXJCdWZmZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0ZWREZXZpY2VCdWZmZXI6IEtpa3UudGhlaXJCdWZmZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRpbmdEZWxheTogS2lrdS5yZWNvcmRpbmdEZWxheVRpbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXR3b3JrRGVsYXk6IEtpa3UubmV0d29ya0RlbGF5VGltZVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlIChyZXN1bHRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBLaWt1LmZsaWdodEFsbG93YW5jZVRpbWUpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHNlbmRSZWNvcmRlZEJ1ZmZlclxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIGRldmljZU5hbWUgOiBEZXZpY2UgdG8gc2VuZCByZWNvcmRlZCBidWZmZXIgdG9cbiAgICAgKiBAcGFyYW0gYnVmZmVyIDogQXVkaW8gYnVmZmVyIHRvIHNlbmRcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHNlbmRSZWNvcmRlZEJ1ZmZlciAoZGV2aWNlTmFtZTogc3RyaW5nLCBidWZmZXI6IEZsb2F0MzJBcnJheSkge1xuICAgICAgICBsZXQgc3RhY2tJbmRleCA9IEtpa3UuZmluZEluZGV4T2ZEZXZpY2UoZGV2aWNlTmFtZSk7XG5cbiAgICAgICAgaWYgKHN0YWNrSW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBsZXQgbWVzc2FnZSA9IG5ldyBNZXNzYWdlRGF0YShNZXNzYWdlVHlwZS5SRVNQT05TRV9SRUNPUkQsIEtpa3UuY3VycmVudFRpbWUoKSwgYnVmZmVyKTtcbiAgICAgICAgICAgIGlmIChLaWt1LnBlZXJDb25uU3RhY2tbc3RhY2tJbmRleF0ub3BlbilcbiAgICAgICAgICAgICAgICBQZWVyQ29ubmVjdGlvbi5zZW5kRGF0YShLaWt1LnBlZXJDb25uU3RhY2tbc3RhY2tJbmRleF0sIG1lc3NhZ2UpO1xuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDb25uZWN0aW9uIHRvIHBlZXIgd2FzIG5vdCBvcGVuIHRvIHNlbmQgdGhlIGRhdGEgdmlhIScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdObyBwZWVyIHdpdGggdGhhdCBJRCB3YXMgZm91bmQgaW4gdGhlIGFjdGl2ZSBjb25uZWN0aW9uIHN0YWNrIScpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBvblN0YXJ0UmVjb3JkaW5nXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgb25TdGFydFJlY29yZGluZyAoKSB7XG4gICAgICAgIGlmIChLaWt1LmN1cnJlbnRNYXN0ZXIgIT09IHRydWUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvblN0YXJ0UmVjb3JkaW5nIGVudGVyaW5nIHNlbmQgbWVzc2FnZScpO1xuICAgICAgICAgICAgS2lrdS5vdXJSZWNvcmRpbmdTdGFydCA9IEtpa3UuY3VycmVudFRpbWUoKTtcbiAgICAgICAgICAgIGxldCBtZXNzYWdlID0gbmV3IE1lc3NhZ2VEYXRhKE1lc3NhZ2VUeXBlLlNUQVJURURfUkVDT1JESU5HKTtcbiAgICAgICAgICAgIGlmIChLaWt1LnBlZXJDb25uU3RhY2tbS2lrdS5hY3RpdmVDb25uXS5vcGVuKXtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU2VuZGluZyBtZXNzYWdlIG9mIHN0YXJ0IHJlY29yZGluZycsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIFBlZXJDb25uZWN0aW9uLnNlbmREYXRhKEtpa3UucGVlckNvbm5TdGFja1tLaWt1LmFjdGl2ZUNvbm5dLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDb25uZWN0aW9uIHRvIHBlZXIgd2FzIG5vdCBvcGVuIHRvIHNlbmQgdGhlIGRhdGEgdmlhIScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZXRSZXR1cm5BbGxvd2FuY2VcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBhbGxvd2FuY2UgOiBSZXR1cm4gdGltZSBhbGxvd2FuY2UgYmVmb3JlIHRpbWVvdXQgd2hlbiB3YWl0aW5nIGZvciBvdGhlciBkZXZpY2UgYnVmZmVyXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBzZXRSZXR1cm5BbGxvd2FuY2UgKGFsbG93YW5jZTogbnVtYmVyKSB7XG4gICAgICAgIEtpa3UuZmxpZ2h0QWxsb3dhbmNlVGltZSA9IGFsbG93YW5jZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGRlbGV0ZVVudXNlZENvbm5lY3Rpb25zXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGRlbGV0ZVVudXNlZENvbm5lY3Rpb25zICgpIHtcbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IEtpa3UucGVlckNvbm5TdGFjay5sZW5ndGg7IGluZGV4Kyspe1xuICAgICAgICAgICAgaWYgKCFLaWt1LnBlZXJDb25uU3RhY2tbaW5kZXhdLm9wZW4pe1xuICAgICAgICAgICAgICAgIEtpa3UucGVlckNvbm5TdGFjay5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBmaW5kSW5kZXhPZkRldmljZVxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBkZXZpY2VOYW1lIDogRGV2aWNlIGlkIHRvIHNlYXJjaCBpbiB0aGUgY29ubmVjdGlvbiBzdGFja1xuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIGZpbmRJbmRleE9mRGV2aWNlIChkZXZpY2VOYW1lOiBzdHJpbmcpIDogbnVtYmVyIHtcblxuICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgS2lrdS5wZWVyQ29ublN0YWNrLmxlbmd0aDsgaW5kZXgrKyl7XG4gICAgICAgICAgICBpZiAoS2lrdS5wZWVyQ29ublN0YWNrW2luZGV4XS5wZWVyID09PSBkZXZpY2VOYW1lKXsgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgb25EYXRhQ2FsbGJhY2tcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0gY29ubiA6IFBlZXJqcyBjb25uZWN0aW9uIHRvIHBhc3MgaW5cbiAgICAgKiBAcGFyYW0gbWVzc2FnZSA6IE1lc3NhZ2UgcmVjZWl2ZWQgb24gdGhlIGNvbm5lY3Rpb25cbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBvbkRhdGFDYWxsYmFjayAoY29ubjogYW55LCBtZXNzYWdlOiBhbnkpIHtcblxuICAgICAgICBjb25zb2xlLmxvZygnbWVzc2FnZSByZWNlaXZlZDonLCBtZXNzYWdlKTtcblxuICAgICAgICBzd2l0Y2ggKG1lc3NhZ2UudHlwZSkge1xuXG4gICAgICAgICAgICBjYXNlIChNZXNzYWdlVHlwZS5SRVFVRVNUX0VNUFRZX1JFU1BPTlNFKTpcbiAgICAgICAgICAgICAgICBsZXQgZW1wdHlSZXNwb25zZSA9IG5ldyBNZXNzYWdlRGF0YShNZXNzYWdlVHlwZS5SRVNQT05TRV9FTVBUWV9SRVNQT05TRSk7XG4gICAgICAgICAgICAgICAgS2lrdS5vdXJOZXR3b3JrVGltZSA9IEtpa3UuY3VycmVudFRpbWUoKTtcbiAgICAgICAgICAgICAgICBQZWVyQ29ubmVjdGlvbi5zZW5kRGF0YShjb25uLCBlbXB0eVJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAoTWVzc2FnZVR5cGUuUkVRVUVTVF9SRUNPUkQpOlxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBc2tlZCB0byBzdGFydCByZWNvcmRpbmcuLi4nKVxuICAgICAgICAgICAgICAgIEtpa3VBdWRpb1N0cmVhbS5yZWNvcmRBdChtZXNzYWdlLnRpbWVTdGFtcCwgS2lrdS5yZWNvcmREdXJhdGlvbikudGhlbigoYnVmZmVyOiBhbnkpPT57XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTdWNjZXNzZnVsbHkgY29tcGxldGVkIHJlY29yZGluZyEnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kUmVjb3JkZWRCdWZmZXIoY29ubi5wZWVyLCBidWZmZXIpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgKE1lc3NhZ2VUeXBlLlNUQVJURURfUkVDT1JESU5HKTpcbiAgICAgICAgICAgICAgICBLaWt1LnRoZWlyUmVjb3JkaW5nU3RhcnQgPSBLaWt1LmN1cnJlbnRUaW1lKCk7XG4gICAgICAgICAgICAgICAgS2lrdS51cGRhdGVSZWNvcmRpbmdEZWxheVRpbWUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAoTWVzc2FnZVR5cGUuUkVTUE9OU0VfRU1QVFlfUkVTUE9OU0UpOlxuICAgICAgICAgICAgICAgIEtpa3UudGhlaXJOZXR3b3JrVGltZSA9IEtpa3UuY3VycmVudFRpbWUoKTtcbiAgICAgICAgICAgICAgICBLaWt1LnVwZGF0ZU5ldHdvcmtEZWxheVRpbWUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSAoTWVzc2FnZVR5cGUuUkVTUE9OU0VfUkVDT1JEKTpcbiAgICAgICAgICAgICAgICBLaWt1LnRoZWlyQnVmZmVyID0gbWVzc2FnZS5hdWRpb0J1ZmZlcjtcbiAgICAgICAgICAgICAgICBLaWt1LmluUmVjb3JkaW5nRmxpZ2h0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBvbkNvbm5lY3Rpb25DYWxsYmFja1xuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBjb25uIDogUGVlcmpzIGNvbm5lY3Rpb25cbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBvbkNvbm5lY3Rpb25DYWxsYmFjayAoY29ubjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdDb25uZWN0aW9uIHJlY2VpdmVkIScsIGNvbm4pO1xuICAgICAgICBLaWt1LnBlZXJDb25uU3RhY2sucHVzaChjb25uKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIG9uT3BlbkNhbGxiYWNrXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgb25PcGVuQ2FsbGJhY2sgKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnQ29ubmVjdGlvbiBvcGVuIScpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgY3VycmVudFRpbWVcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBjdXJyZW50VGltZSAoKSA6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0ICsgcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB1cGRhdGVOZXR3b3JrRGVsYXlUaW1lXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgdXBkYXRlTmV0d29ya0RlbGF5VGltZSAoKSB7XG4gICAgICAgIEtpa3Uub3VyTmV0d29ya1RpbWUgPSBLaWt1Lm91ck5ldHdvcmtUaW1lIHx8IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgICBLaWt1LnRoZWlyTmV0d29ya1RpbWUgPSBLaWt1LnRoZWlyTmV0d29ya1RpbWUgfHwgS2lrdS5vdXJOZXR3b3JrVGltZTtcbiAgICAgICAgS2lrdS5uZXR3b3JrRGVsYXlUaW1lID0gTWF0aC5hYnMoS2lrdS5vdXJOZXR3b3JrVGltZSAtIEtpa3UudGhlaXJOZXR3b3JrVGltZSkvMjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHVwZGF0ZVJlY29yZGluZ0RlbGF5VGltZVxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIHVwZGF0ZVJlY29yZGluZ0RlbGF5VGltZSAoKSB7XG4gICAgICAgIEtpa3UucmVjb3JkaW5nRGVsYXlUaW1lID0gTWF0aC5hYnMoS2lrdS5vdXJSZWNvcmRpbmdTdGFydCAtIEtpa3UudGhlaXJSZWNvcmRpbmdTdGFydCkvMjtcbiAgICB9XG5cbn1cblxuLyoqXG4gKiBAY2xhc3MgUGVlckNvbm5lY3Rpb25cbiAqL1xuY2xhc3MgUGVlckNvbm5lY3Rpb24ge1xuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZW5kRGF0YVxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIGNvbm4gOiBQZWVyanMgY29ubmVjdGlvbiBvYmplY3RcbiAgICAgKiBAcGFyYW0gbWVzc2FnZURhdGEgOiBNZXNzYWdlRGF0YSBvYmplY3Qgd2l0aCBkYXRhIHRvIHNlbmRcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHNlbmREYXRhIChjb25uOiBhbnksIG1lc3NhZ2VEYXRhOiBNZXNzYWdlRGF0YSkge1xuXG4gICAgICAgIGxldCBtZXNzYWdlOiBPYmplY3QgPSB7XG4gICAgICAgICAgICB0eXBlOiBtZXNzYWdlRGF0YS50eXBlLFxuICAgICAgICAgICAgdGltZVN0YW1wOiBtZXNzYWdlRGF0YS50aW1lU3RhbXAgfHwgJycsXG4gICAgICAgICAgICBhdWRpb0J1ZmZlcjogbWVzc2FnZURhdGEuYXVkaW9CdWZmZXIgfHwgJydcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoY29ubi5fb3Blbikge1xuICAgICAgICAgICAgY29ubi5zZW5kKG1lc3NhZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdUcmllZCB0byBzZW5kIG1lc3NhZ2Ugd2hlbiBjb25uZWN0aW9uIGlzIGNsb3NlZCEnLCBtZXNzYWdlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBAY2xhc3MgTWVzc2FnZURhdGFcbiAqL1xuY2xhc3MgTWVzc2FnZURhdGEge1xuXG4gICAgdHlwZTogc3RyaW5nO1xuICAgIHRpbWVTdGFtcD86IG51bWJlcjtcbiAgICBhdWRpb0J1ZmZlcj86IEZsb2F0MzJBcnJheTtcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSBtZXNzYWdlVHlwZSA6IE1lc3NhZ2UgdHlwZSB0byBzZW5kIG9mIHR5cGUgZW51bSBNZXNzYWdlVHlwZVxuICAgICAqIEBwYXJhbSB0aW1lU3RhbXAgOiBUaW1pbmcgaW5mb3JtYXRpb24gcmVsYXRlZCB0byB0aGUgbWVzc2FnZVxuICAgICAqIEBwYXJhbSBhdWRpb0J1ZmZlciA6IEF1ZGlvIGJ1ZmZlciB0byBzZW5kXG4gICAgICovXG4gICAgY29uc3RydWN0b3IgKG1lc3NhZ2VUeXBlOiBzdHJpbmcsIHRpbWVTdGFtcD86IG51bWJlciwgYXVkaW9CdWZmZXI/OiBGbG9hdDMyQXJyYXkpIHtcbiAgICAgICAgdGhpcy50eXBlID0gbWVzc2FnZVR5cGU7XG4gICAgICAgIHRoaXMudGltZVN0YW1wID0gdGltZVN0YW1wO1xuICAgICAgICB0aGlzLmF1ZGlvQnVmZmVyID0gYXVkaW9CdWZmZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB0b09iamVjdFxuICAgICAqIEBwdWJsaWNcbiAgICAgKi9cbiAgICBwdWJsaWMgdG9PYmplY3QgKCkgOiBPYmplY3Qge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbWVzc2FnZVR5cGU6IHRoaXMudHlwZSxcbiAgICAgICAgICAgIHRpbWVTdGFtcDogdGhpcy50aW1lU3RhbXAgfHwgW10sXG4gICAgICAgICAgICBhdWRpb0J1ZmZlcjogdGhpcy5hdWRpb0J1ZmZlciB8fCBbXVxuICAgICAgICB9O1xuICAgIH1cblxufVxuXG4vKipcbiAqIEBlbnVtIE1lc3NhZ2VUeXBlXG4gKi9cbmVudW0gTWVzc2FnZVR5cGUge1xuXG4gICAgUkVRVUVTVF9SRUNPUkQgPSAncmVxdWVzdFJlY29yZCcsXG4gICAgUkVTUE9OU0VfUkVDT1JEID0gJ3Jlc3BvbnNlUmVjb3JkJyxcblxuICAgIFNUQVJURURfUkVDT1JESU5HID0gJ3N0YXJ0ZWRSZWNvcmRpbmcnLFxuICAgIFNUT1BQRURfUkVDT1JESU5HID0gJ3N0b3BwZWRSZWNvcmRpbmcnLFxuXG4gICAgUkVRVUVTVF9FTVBUWV9SRVNQT05TRSA9ICdyZXF1ZXN0RW1wdHlSZXNwb25zZScsXG4gICAgUkVTUE9OU0VfRU1QVFlfUkVTUE9OU0UgPSAncmVzcG9uc2VFbXB0eVJlc3BvbnNlJ1xuXG59XG5cbi8vIEFzc2lnbiB0byB3aW5kb3cgZm9yIGVhc3kgSlMgc3RhcnR1cFxuKDxhbnk+d2luZG93KS5LaWt1ID0gS2lrdTtcbiIsImRlY2xhcmUgdmFyIE1lZGlhUmVjb3JkZXI6IGFueTtcblxuLyoqXG4gKiBAY2xhc3MgS2lrdUF1ZGlvU3RyZWFtXG4gKi9cbmV4cG9ydCBjbGFzcyBLaWt1QXVkaW9TdHJlYW0ge1xuXG4gICAgc3RhdGljIGlzUmVjb3JkaW5nOiBib29sZWFuID0gZmFsc2U7XG4gICAgc3RhdGljIGFjdGl2ZUJ1ZmZlcjogRmxvYXQzMkFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSgxKTtcbiAgICBzdGF0aWMgcmVjb3JkZWRCdWZmZXI6IEZsb2F0MzJBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7XG5cbiAgICBwdWJsaWMgc3RhdGljIHN0YXJ0ZWRSZWNvcmRpbmc6IEZ1bmN0aW9uID0gKCkgPT4ge307XG4gICAgcHVibGljIHN0YXRpYyBmaW5pc2hlZFJlY29yZGluZzogRnVuY3Rpb24gPSAoKSA9PiB7fTtcblxuICAgIHN0YXRpYyBhdWRpb0NvbnRleHQ6IEF1ZGlvQ29udGV4dCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcbiAgICBzdGF0aWMgc2NyaXB0Tm9kZT86IFNjcmlwdFByb2Nlc3Nvck5vZGU7XG4gICAgc3RhdGljIG1lZGlhU3RyZWFtU291cmNlTm9kZT86IE1lZGlhU3RyZWFtQXVkaW9Tb3VyY2VOb2RlO1xuXG4gICAgc3RhdGljIG1pY1JlY29yZGVyPzogTWVkaWFTdHJlYW07XG5cbiAgICBzdGF0aWMgc3VwcG9ydGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIHN0YXRpYyByZXNldEF1ZGlvQnVmZmVyOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHNldHVwXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHNldHVwICgpIHtcblxuICAgICAgICBLaWt1QXVkaW9TdHJlYW0uYXVkaW9Db250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpIHx8ICg8YW55PndpbmRvdykud2Via2l0QXVkaW9Db250ZXh0KCk7XG5cbiAgICAgICAgaWYgKG5hdmlnYXRvci5tZWRpYURldmljZXMgJiYgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpIHtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2dldFVzZXJNZWRpYSBzdXBwb3J0ZWQuJyk7XG4gICAgICAgICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSAoXG4gICAgICAgICAgICAgICA8YW55PntcbiAgICAgICAgICAgICAgICBcImF1ZGlvXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJtYW5kYXRvcnlcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJnb29nRWNob0NhbmNlbGxhdGlvblwiOiBcImZhbHNlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImdvb2dBdXRvR2FpbkNvbnRyb2xcIjogXCJmYWxzZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJnb29nTm9pc2VTdXBwcmVzc2lvblwiOiBcImZhbHNlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImdvb2dIaWdocGFzc0ZpbHRlclwiOiBcImZhbHNlXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgXCJvcHRpb25hbFwiOiBbXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgIH0pIC8vIFJlcXVlc3QgcGVybWlzc2lvbnNcbiAgICAgICAgIFxuICAgICAgICAgICAgICAgLy8gU3VjY2VzcyBjYWxsYmFja1xuICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHN0cmVhbSkge1xuICAgICAgICAgICAgICAgICAgICBLaWt1QXVkaW9TdHJlYW0uc2V0dXBTdHJlYW0oc3RyZWFtKTtcbiAgICAgICAgICAgICAgIH0pXG4gICAgICAgICBcbiAgICAgICAgICAgICAgIC8vIEVycm9yIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1RoZSBmb2xsb3dpbmcgZ2V0VXNlck1lZGlhIGVycm9yIG9jY3VyZWQ6ICcgKyBlcnIpO1xuICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgKTtcbiAgICBcbiAgICAgICAgIH0gZWxzZSB7IC8vIE1lZGlhIGRldmljZXMgd2VyZW4ndCBhdmFpbGFibGVcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignZ2V0VXNlck1lZGlhIG5vdCBzdXBwb3J0ZWQgb24geW91ciBicm93c2VyIScpO1xuICAgICAgICAgfVxuXG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGxpc3RlbkZvclN0YXJ0XG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgOiBDYWxsYmFjayB0byBjYWxsIG9uIHRoZSBzdGFydCBvZiByZWNvcmRpbmdcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGxpc3RlbkZvclN0YXJ0IChjYWxsYmFjazogRnVuY3Rpb24pIHtcbiAgICAgICAgdGhpcy5zdGFydGVkUmVjb3JkaW5nID0gY2FsbGJhY2s7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBsaXN0ZW5Gb3JFbmRcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBjYWxsYmFjayA6IENhbGxiYWNrIHRvIGNhbGwgb24gdGhlIGVuZCBvZiByZWNvcmRpbmdcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGxpc3RlbkZvckVuZCAoY2FsbGJhY2s6IEZ1bmN0aW9uKSB7XG4gICAgICAgIHRoaXMuZmluaXNoZWRSZWNvcmRpbmcgPSBjYWxsYmFjaztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGZsb2F0MzJidWZmZXJDb25jYXRcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0gYnVmZmVyMCBcbiAgICAgKiBAcGFyYW0gYnVmZmVyMSBcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBmbG9hdDMyYnVmZmVyQ29uY2F0IChidWZmZXIwOiBGbG9hdDMyQXJyYXksIGJ1ZmZlcjE6IEZsb2F0MzJBcnJheSkge1xuXG4gICAgICAgIGxldCBpdGVtMExlbmd0aCA9IGJ1ZmZlcjAubGVuZ3RoO1xuICAgICAgICBsZXQgcmVzdWx0ID0gbmV3IEZsb2F0MzJBcnJheShpdGVtMExlbmd0aCArIGJ1ZmZlcjEubGVuZ3RoKTtcbiAgICBcbiAgICAgICAgcmVzdWx0LnNldChidWZmZXIwKTtcbiAgICAgICAgcmVzdWx0LnNldChidWZmZXIxLCBpdGVtMExlbmd0aCk7XG4gICAgXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHNldHVwU3RyZWFtXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHN0cmVhbSA6IE1lZGlhIHN0cmVhbSB0byBzZXR1cCBhdWRpbyByZWNvcmRpbmcgXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgc2V0dXBTdHJlYW0gKHN0cmVhbTogTWVkaWFTdHJlYW0pIHtcblxuICAgICAgICAvLyBVcGRhdGUgc3RyZWFtIGluZm9cbiAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLnN1cHBvcnRlZCA9IHRydWU7XG4gICAgICAgIHRoaXMubWljUmVjb3JkZXIgPSBuZXcgTWVkaWFSZWNvcmRlcihzdHJlYW0pO1xuXG4gICAgICAgIC8vIENyZWF0ZSBsaXZlIGF1ZGlvIGNvbnRleHQgcHJvY2Vzc2luZ1xuICAgICAgICBLaWt1QXVkaW9TdHJlYW0uc2NyaXB0Tm9kZSA9IEtpa3VBdWRpb1N0cmVhbS5hdWRpb0NvbnRleHQuY3JlYXRlU2NyaXB0UHJvY2Vzc29yKDEwMjQsIDEsIDEpO1xuICAgICAgICBLaWt1QXVkaW9TdHJlYW0ubWVkaWFTdHJlYW1Tb3VyY2VOb2RlID0gS2lrdUF1ZGlvU3RyZWFtLmF1ZGlvQ29udGV4dC5jcmVhdGVNZWRpYVN0cmVhbVNvdXJjZShzdHJlYW0pO1xuXG4gICAgICAgIC8vIENhbGxiYWNrIGZvciBzY3JpcHQgcHJvY2Vzc29yIGZ1bmN0aW9uXG4gICAgICAgIEtpa3VBdWRpb1N0cmVhbS5zY3JpcHROb2RlLm9uYXVkaW9wcm9jZXNzID0gZnVuY3Rpb24oZXZlbnQpIHtcblxuICAgICAgICAgICAgLy8gQWRkIG9udG8gcmVjb3JkZWQgZGF0YSB3aGVuIHNldCB0byB0cnVlXG4gICAgICAgICAgICBpZihLaWt1QXVkaW9TdHJlYW0uaXNSZWNvcmRpbmcpIHtcbiAgICAgICAgICAgICAgICBLaWt1QXVkaW9TdHJlYW0uYWN0aXZlQnVmZmVyID0gS2lrdUF1ZGlvU3RyZWFtLmZsb2F0MzJidWZmZXJDb25jYXQoS2lrdUF1ZGlvU3RyZWFtLmFjdGl2ZUJ1ZmZlciwgZXZlbnQuaW5wdXRCdWZmZXIuZ2V0Q2hhbm5lbERhdGEoMCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoS2lrdUF1ZGlvU3RyZWFtLnJlc2V0QXVkaW9CdWZmZXIgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgbWVtb3J5IGZvciBnYXJiYWdlIGNvbGxlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLmFjdGl2ZUJ1ZmZlciA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7XG4gICAgICAgICAgICAgICAgICAgIEtpa3VBdWRpb1N0cmVhbS5yZXNldEF1ZGlvQnVmZmVyID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQ29ubmVjdCBzb3VyY2UgdG8gc2NyaXB0IHByb2Nlc3NvclxuICAgICAgICBLaWt1QXVkaW9TdHJlYW0ubWVkaWFTdHJlYW1Tb3VyY2VOb2RlLmNvbm5lY3QoS2lrdUF1ZGlvU3RyZWFtLnNjcmlwdE5vZGUpO1xuICAgICAgICBLaWt1QXVkaW9TdHJlYW0uc2NyaXB0Tm9kZS5jb25uZWN0KEtpa3VBdWRpb1N0cmVhbS5hdWRpb0NvbnRleHQuZGVzdGluYXRpb24pO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCByZWNvcmRBdFxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIHRpbWUgOiBUaW1lIHRvIHN0YXJ0IHJlY29yZGluZyBhdCAodW5peCB0aW1lKVxuICAgICAqIEBwYXJhbSBkdXJhdGlvbiA6IER1cmF0aW9uIHRvIHJlY29yZCBmb3IgKG1zKVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgcmVjb3JkQXQgKHRpbWU6IG51bWJlciwgZHVyYXRpb246IG51bWJlcikge1xuXG4gICAgICAgIC8vIEVzdGltYXRlIGV4ZWN1dGlvbiB0aW1lXG4gICAgICAgIGxldCBldGFfbXMgPSB0aW1lIC0gS2lrdUF1ZGlvU3RyZWFtLmN1cnJlbnRUaW1lKCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdTdGFydGluZyB0byByZWNvcmQgaW4gJyArIGV0YV9tcyArICcgZnJvbSBub3cgKCcgKyBldGFfbXMvMTAwMCArICcpJyk7XG5cbiAgICAgICAgLy8gRGVjbGFyZSBjYWxsYmFjayB1bnRpbCBleGVjdXRpb24gdGltZVxuICAgICAgICBsZXQgd2FpdFVudGlsID0gKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlICgocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PntcbiAgICAgICAgICAgICAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLnJlY29yZChkdXJhdGlvbikudGhlbigocmVjb3JkaW5nKT0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZWNvcmRpbmcpO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0sIGV0YV9tcyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIFdhaXQgdW50aWwgZXhlY3V0aW9uIHRpbWVcbiAgICAgICAgbGV0IHJlY29yZGluZyA9IGF3YWl0IHdhaXRVbnRpbCgpO1xuXG4gICAgICAgIC8vIFJldHVybiByZWNvcmRlZCBidWZmZXJcbiAgICAgICAgcmV0dXJuIHJlY29yZGluZztcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgcmVjb3JkXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gZHVyYXRpb24gOiBMZW5ndGggdG8gcmVjb3JkIGZvciAobXMpXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyByZWNvcmQgKGR1cmF0aW9uOiBudW1iZXIpIHtcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UgKChyZXNvbHZlKSA9PiB7XG5cbiAgICAgICAgICAgIC8vIFNldCByZWNvcmQgYXRvbWljIGJvb2xlYW4gdHJ1ZVxuICAgICAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLmlzUmVjb3JkaW5nID0gdHJ1ZTtcblxuICAgICAgICAgICAgLy8gTm90aWZ5IGxpc3RlbmVyc1xuICAgICAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLnN0YXJ0ZWRSZWNvcmRpbmcoKTtcblxuICAgICAgICAgICAgLy8gVGltZW91dCB1bnRpbCBmaW5pc2hcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PntcbiAgICAgICAgICAgICAgICBLaWt1QXVkaW9TdHJlYW0uaXNSZWNvcmRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBLaWt1QXVkaW9TdHJlYW0ucmVjb3JkZWRCdWZmZXIgPSBLaWt1QXVkaW9TdHJlYW0uYWN0aXZlQnVmZmVyO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoS2lrdUF1ZGlvU3RyZWFtLnJlY29yZGVkQnVmZmVyKTtcbiAgICAgICAgICAgIH0sIGR1cmF0aW9uKTtcblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHJlY29yZGluZ1xuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyByZWNvcmRpbmcgKCkgOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIEtpa3VBdWRpb1N0cmVhbS5pc1JlY29yZGluZztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGdldExhc3RSZWNvcmRlZEJ1ZmZlclxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBnZXRMYXN0UmVjb3JkZWRCdWZmZXIgKCkgOiBGbG9hdDMyQXJyYXkge1xuICAgICAgICByZXR1cm4gS2lrdUF1ZGlvU3RyZWFtLnJlY29yZGVkQnVmZmVyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgY3VycmVudFRpbWVcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBjdXJyZW50VGltZSAoKSA6IG51bWJlciB7XG4gICAgICAgIHJldHVybiBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0ICsgcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==