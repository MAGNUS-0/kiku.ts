!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);class o{static setup(){o.peerConnStack=new Array(0),o.activeConn=0,void 0!==window.Peer&&(o.peerjs=window.Peer),n.KikuAudioStream.setup(),n.KikuAudioStream.listenForStart(o.onStartRecording)}static connectToServer(e,t,r,n){o.myname=e,o.serverAddr=t,o.serverPort=r,o.serverPath=n;let i={host:o.serverAddr,port:o.serverPort,path:o.serverPath};o.peer=new o.peerjs(o.myname,i),o.peer.on("connection",e=>{o.onConnectionCallback(e),e.on("data",t=>{o.onDataCallback(e,t)})})}static connectToDevice(e){let t=o.peer.connect(e);t.on("open",()=>{t.on("data",e=>{o.onDataCallback(t,e)})}),o.peerConnStack.push(t)}static sendEmptyResponse(e){let t=o.findIndexOfDevice(e);if(-1!==t){let e=new a(c.REQUEST_EMPTY_RESPONSE);o.peerConnStack[t].open?(o.ourNetworkTime=o.currentTime(),i.sendData(o.peerConnStack[t],e)):console.warn("Connection to peer was not open to send the data via!")}else console.warn("No peer with that ID was found in the active connection stack!")}static async startRecording(e,t){o.currentMaster=!0,o.inRecordingFlight=!0,o.activeConn=o.findIndexOfDevice(e);let r=performance.timeOrigin+performance.now()+t,s=o.findIndexOfDevice(e);if(-1!==s){let e=new a(c.REQUEST_RECORD,r);console.log("Sending start record message",e),o.peerConnStack[s].open?i.sendData(o.peerConnStack[s],e):console.warn("Connection to peer was not open to send the data via!")}else console.warn("No peer with that ID was found in the active connection stack!");let d=await n.KikuAudioStream.recordAt(r,o.recordDuration);return o.ourBuffer=d,o.currentMaster=!1,new Promise((e,t)=>{setTimeout(()=>{if(o.inRecordingFlight)t("Recording was still in flight and was not transfered back to this device in time");else{let t={currentDeviceBuffer:o.ourBuffer,requestedDeviceBuffer:o.theirBuffer,recordingDelay:o.recordingDelayTime,networkDelay:o.networkDelayTime};e(t)}},o.flightAllowanceTime)})}static sendRecordedBuffer(e,t){let r=o.findIndexOfDevice(e);if(-1!==r){let e=new a(c.RESPONSE_RECORD,o.currentTime(),t);o.peerConnStack[r].open?i.sendData(o.peerConnStack[r],e):console.warn("Connection to peer was not open to send the data via!")}else console.warn("No peer with that ID was found in the active connection stack!")}static onStartRecording(){if(!0!==o.currentMaster){console.log("onStartRecording entering send message"),o.ourRecordingStart=o.currentTime();let e=new a(c.STARTED_RECORDING);o.peerConnStack[o.activeConn].open?(console.log("Sending message of start recording",e),i.sendData(o.peerConnStack[o.activeConn],e)):console.warn("Connection to peer was not open to send the data via!")}}static setReturnAllowance(e){o.flightAllowanceTime=e}static deleteUnusedConnections(){for(let e=0;e<o.peerConnStack.length;e++)o.peerConnStack[e].open||o.peerConnStack.splice(e,1)}static findIndexOfDevice(e){for(var t=0;t<o.peerConnStack.length;t++)if(o.peerConnStack[t].peer===e)return t;return-1}static onDataCallback(e,t){switch(console.log("message received:",t),t.type){case c.REQUEST_EMPTY_RESPONSE:let r=new a(c.RESPONSE_EMPTY_RESPONSE);o.ourNetworkTime=o.currentTime(),i.sendData(e,r);break;case c.REQUEST_RECORD:console.log("Asked to start recording..."),n.KikuAudioStream.recordAt(t.timeStamp,o.recordDuration).then(t=>{console.log("Successfully completed recording!"),this.sendRecordedBuffer(e.peer,t)});break;case c.STARTED_RECORDING:o.theirRecordingStart=o.currentTime(),o.updateRecordingDelayTime();break;case c.RESPONSE_EMPTY_RESPONSE:o.theirNetworkTime=o.currentTime(),o.updateNetworkDelayTime();break;case c.RESPONSE_RECORD:o.theirBuffer=t.audioBuffer,o.inRecordingFlight=!1}}static onConnectionCallback(e){console.log("Connection received!",e),o.peerConnStack.push(e)}static onOpenCallback(){console.log("Connection open!")}static currentTime(){return performance.timing.navigationStart+performance.now()}static updateNetworkDelayTime(){o.ourNetworkTime=o.ourNetworkTime||performance.now(),o.theirNetworkTime=o.theirNetworkTime||o.ourNetworkTime,o.networkDelayTime=Math.abs(o.ourNetworkTime-o.theirNetworkTime)/2}static updateRecordingDelayTime(){o.recordingDelayTime=Math.abs(o.ourRecordingStart-o.theirRecordingStart)/2}}o.activeConn=0,o.flightAllowanceTime=1e3,o.networkDelayTime=10,o.recordingDelayTime=0,o.ourRecordingStart=o.currentTime(),o.theirRecordingStart=o.currentTime(),o.recordDuration=2500,o.buffersReady=!1,o.ourBuffer=new Float32Array(1),o.theirBuffer=new Float32Array(1),o.inRecordingFlight=!1,o.currentMaster=!1;class i{static sendData(e,t){let r={type:t.type,timeStamp:t.timeStamp||"",audioBuffer:t.audioBuffer||""};e._open?e.send(r):console.warn("Tried to send message when connection is closed!",r)}}class a{constructor(e,t,r){this.type=e,this.timeStamp=t,this.audioBuffer=r}toObject(){return{messageType:this.type,timeStamp:this.timeStamp||[],audioBuffer:this.audioBuffer||[]}}}var c;!function(e){e.REQUEST_RECORD="requestRecord",e.RESPONSE_RECORD="responseRecord",e.STARTED_RECORDING="startedRecording",e.STOPPED_RECORDING="stoppedRecording",e.REQUEST_EMPTY_RESPONSE="requestEmptyResponse",e.RESPONSE_EMPTY_RESPONSE="responseEmptyResponse"}(c||(c={})),window.Kiku=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{static setup(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(console.log("getUserMedia supported."),navigator.mediaDevices.getUserMedia({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"},optional:[]}}).then(function(e){n.setupStream(e)}).catch(function(e){console.warn("The following getUserMedia error occured: "+e)})):console.warn("getUserMedia not supported on your browser!")}static listenForStart(e){this.startedRecording=e}static listenForEnd(e){this.finishedRecording=e}static float32bufferConcat(e,t){let r=e.length,n=new Float32Array(r+t.length);return n.set(e),n.set(t,r),n}static setupStream(e){n.supported=!0,this.micRecorder=new MediaRecorder(e),n.scriptNode=this.audioContext.createScriptProcessor(1024,1,1),n.mediaStreamSourceNode=this.audioContext.createMediaStreamSource(e),n.scriptNode.onaudioprocess=function(e){n.isRecording?n.activeBuffer=n.float32bufferConcat(n.activeBuffer,e.inputBuffer.getChannelData(0)):!0===n.resetAudioBuffer&&(n.activeBuffer=new Float32Array(1),n.resetAudioBuffer=!1)},n.mediaStreamSourceNode.connect(n.scriptNode),n.scriptNode.connect(n.audioContext.destination)}static async recordAt(e,t){let r=e-n.currentTime();console.log("Starting to record in "+r+" from now ("+r/1e3+")");return await(()=>new Promise(e=>{setTimeout(()=>{n.record(t).then(t=>{e(t)})},r)}))()}static record(e){return new Promise(t=>{n.isRecording=!0,n.startedRecording(),setTimeout(()=>{n.isRecording=!1,n.recordedBuffer=n.activeBuffer,t(n.recordedBuffer)},e)})}static recording(){return n.isRecording}static getLastRecordedBuffer(){return n.recordedBuffer}static currentTime(){return performance.timing.navigationStart+performance.now()}}n.isRecording=!1,n.activeBuffer=new Float32Array(1),n.recordedBuffer=new Float32Array(1),n.startedRecording=(()=>{}),n.finishedRecording=(()=>{}),n.audioContext=new AudioContext||window.webkitAudioContext(),n.supported=!1,n.resetAudioBuffer=!1,t.KikuAudioStream=n}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2tpa3UudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2tpa3VhdWRpb3N0cmVhbS50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImtpa3VhdWRpb3N0cmVhbV8xIiwiS2lrdSIsIltvYmplY3QgT2JqZWN0XSIsInBlZXJDb25uU3RhY2siLCJBcnJheSIsImFjdGl2ZUNvbm4iLCJ1bmRlZmluZWQiLCJ3aW5kb3ciLCJQZWVyIiwicGVlcmpzIiwiS2lrdUF1ZGlvU3RyZWFtIiwic2V0dXAiLCJsaXN0ZW5Gb3JTdGFydCIsIm9uU3RhcnRSZWNvcmRpbmciLCJzZXJ2ZXJBZGRyIiwic2VydmVyUG9ydCIsInNlcnZlclBhdGgiLCJteW5hbWUiLCJzZXJ2ZXJJbmZvIiwiaG9zdCIsInBvcnQiLCJwYXRoIiwicGVlciIsIm9uIiwiY29ubiIsIm9uQ29ubmVjdGlvbkNhbGxiYWNrIiwibWVzc2FnZSIsIm9uRGF0YUNhbGxiYWNrIiwiZGV2aWNlTmFtZSIsInBlZXJDb25uIiwiY29ubmVjdCIsInB1c2giLCJzdGFja0luZGV4IiwiZmluZEluZGV4T2ZEZXZpY2UiLCJNZXNzYWdlRGF0YSIsIk1lc3NhZ2VUeXBlIiwiUkVRVUVTVF9FTVBUWV9SRVNQT05TRSIsIm9wZW4iLCJvdXJOZXR3b3JrVGltZSIsImN1cnJlbnRUaW1lIiwiUGVlckNvbm5lY3Rpb24iLCJzZW5kRGF0YSIsImNvbnNvbGUiLCJ3YXJuIiwiZnJvbU5vdyIsImN1cnJlbnRNYXN0ZXIiLCJpblJlY29yZGluZ0ZsaWdodCIsInRpbWVTdGFtcCIsInBlcmZvcm1hbmNlIiwidGltZU9yaWdpbiIsIm5vdyIsIlJFUVVFU1RfUkVDT1JEIiwibG9nIiwiYnVmZmVyIiwicmVjb3JkQXQiLCJyZWNvcmREdXJhdGlvbiIsIm91ckJ1ZmZlciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwic2V0VGltZW91dCIsInJlc3VsdHMiLCJjdXJyZW50RGV2aWNlQnVmZmVyIiwicmVxdWVzdGVkRGV2aWNlQnVmZmVyIiwidGhlaXJCdWZmZXIiLCJyZWNvcmRpbmdEZWxheSIsInJlY29yZGluZ0RlbGF5VGltZSIsIm5ldHdvcmtEZWxheSIsIm5ldHdvcmtEZWxheVRpbWUiLCJmbGlnaHRBbGxvd2FuY2VUaW1lIiwiUkVTUE9OU0VfUkVDT1JEIiwib3VyUmVjb3JkaW5nU3RhcnQiLCJTVEFSVEVEX1JFQ09SRElORyIsImFsbG93YW5jZSIsImluZGV4IiwibGVuZ3RoIiwic3BsaWNlIiwidHlwZSIsImVtcHR5UmVzcG9uc2UiLCJSRVNQT05TRV9FTVBUWV9SRVNQT05TRSIsInRoZW4iLCJ0aGlzIiwic2VuZFJlY29yZGVkQnVmZmVyIiwidGhlaXJSZWNvcmRpbmdTdGFydCIsInVwZGF0ZVJlY29yZGluZ0RlbGF5VGltZSIsInRoZWlyTmV0d29ya1RpbWUiLCJ1cGRhdGVOZXR3b3JrRGVsYXlUaW1lIiwiYXVkaW9CdWZmZXIiLCJ0aW1pbmciLCJuYXZpZ2F0aW9uU3RhcnQiLCJNYXRoIiwiYWJzIiwiYnVmZmVyc1JlYWR5IiwiRmxvYXQzMkFycmF5IiwibWVzc2FnZURhdGEiLCJfb3BlbiIsInNlbmQiLCJtZXNzYWdlVHlwZSIsIm5hdmlnYXRvciIsIm1lZGlhRGV2aWNlcyIsImdldFVzZXJNZWRpYSIsImF1ZGlvIiwibWFuZGF0b3J5IiwiZ29vZ0VjaG9DYW5jZWxsYXRpb24iLCJnb29nQXV0b0dhaW5Db250cm9sIiwiZ29vZ05vaXNlU3VwcHJlc3Npb24iLCJnb29nSGlnaHBhc3NGaWx0ZXIiLCJvcHRpb25hbCIsInN0cmVhbSIsInNldHVwU3RyZWFtIiwiY2F0Y2giLCJlcnIiLCJjYWxsYmFjayIsInN0YXJ0ZWRSZWNvcmRpbmciLCJmaW5pc2hlZFJlY29yZGluZyIsImJ1ZmZlcjAiLCJidWZmZXIxIiwiaXRlbTBMZW5ndGgiLCJyZXN1bHQiLCJzZXQiLCJzdXBwb3J0ZWQiLCJtaWNSZWNvcmRlciIsIk1lZGlhUmVjb3JkZXIiLCJzY3JpcHROb2RlIiwiYXVkaW9Db250ZXh0IiwiY3JlYXRlU2NyaXB0UHJvY2Vzc29yIiwibWVkaWFTdHJlYW1Tb3VyY2VOb2RlIiwiY3JlYXRlTWVkaWFTdHJlYW1Tb3VyY2UiLCJvbmF1ZGlvcHJvY2VzcyIsImV2ZW50IiwiaXNSZWNvcmRpbmciLCJhY3RpdmVCdWZmZXIiLCJmbG9hdDMyYnVmZmVyQ29uY2F0IiwiaW5wdXRCdWZmZXIiLCJnZXRDaGFubmVsRGF0YSIsInJlc2V0QXVkaW9CdWZmZXIiLCJkZXN0aW5hdGlvbiIsInRpbWUiLCJkdXJhdGlvbiIsImV0YV9tcyIsInJlY29yZCIsInJlY29yZGluZyIsIndhaXRVbnRpbCIsInJlY29yZGVkQnVmZmVyIiwiQXVkaW9Db250ZXh0Iiwid2Via2l0QXVkaW9Db250ZXh0Il0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFFBQUEsSUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVB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QkFHaEJyRCxXQUFXLEtBQ1BsRCxFQUFnQndILGFBQWMsRUFDOUJ4SCxFQUFnQnFJLGVBQWlCckksRUFBZ0J5SCxhQUNqRHpFLEVBQVFoRCxFQUFnQnFJLGlCQUN6QkwsS0FVSnhJLG1CQUNILE9BQU9RLEVBQWdCd0gsWUFRcEJoSSwrQkFDSCxPQUFPUSxFQUFnQnFJLGVBUW5CN0kscUJBQ0osT0FBTzhDLFlBQVl3QyxPQUFPQyxnQkFBa0J6QyxZQUFZRSxPQTFOckR4QyxFQUFBd0gsYUFBdUIsRUFDdkJ4SCxFQUFBeUgsYUFBNkIsSUFBSXRDLGFBQWEsR0FDOUNuRixFQUFBcUksZUFBK0IsSUFBSWxELGFBQWEsR0FFekNuRixFQUFBdUcsaUJBQTZCLFNBQzdCdkcsRUFBQXdHLGtCQUE4QixTQUVyQ3hHLEVBQUFrSCxhQUE2QixJQUFJb0IsY0FBd0J6SSxPQUFRMEkscUJBTWpFdkksRUFBQThHLFdBQXFCLEVBRWI5RyxFQUFBNkgsa0JBQTRCLEVBakIvQ3pLLEVBQUE0QyIsImZpbGUiOiJsaWJraWt1Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCB7IEtpa3VBdWRpb1N0cmVhbSB9IGZyb20gJy4va2lrdWF1ZGlvc3RyZWFtJztcblxuLyoqXG4gKiBAY2xhc3MgS2lrdVxuICovXG5jbGFzcyBLaWt1IHtcblxuICAgIHN0YXRpYyBteW5hbWU/OiBzdHJpbmc7XG4gICAgc3RhdGljIHNlcnZlckFkZHI/OiBzdHJpbmc7XG4gICAgc3RhdGljIHNlcnZlclBvcnQ/OiBzdHJpbmc7XG4gICAgc3RhdGljIHNlcnZlclBhdGg/OiBzdHJpbmc7XG4gICAgc3RhdGljIHBlZXJqcz86IGFueTtcbiAgICBzdGF0aWMgcGVlcj86IGFueTtcbiAgICBzdGF0aWMgcGVlckNvbm5TdGFjazogYW55W107XG4gICAgc3RhdGljIGFjdGl2ZUNvbm46IG51bWJlciA9IDA7XG4gICAgc3RhdGljIGZsaWdodEFsbG93YW5jZVRpbWU6IG51bWJlciA9IDEwMDA7XG5cbiAgICBzdGF0aWMgbmV0d29ya0RlbGF5VGltZTogbnVtYmVyID0gMTA7XG4gICAgc3RhdGljIG91ck5ldHdvcmtUaW1lPzogbnVtYmVyOyBcbiAgICBzdGF0aWMgdGhlaXJOZXR3b3JrVGltZT86IG51bWJlcjsgXG5cbiAgICBzdGF0aWMgcmVjb3JkaW5nRGVsYXlUaW1lOiBudW1iZXIgPSAwO1xuICAgIHN0YXRpYyBvdXJSZWNvcmRpbmdTdGFydDogbnVtYmVyID0gS2lrdS5jdXJyZW50VGltZSgpO1xuICAgIHN0YXRpYyB0aGVpclJlY29yZGluZ1N0YXJ0OiBudW1iZXIgPSBLaWt1LmN1cnJlbnRUaW1lKCk7XG5cbiAgICBzdGF0aWMgcmVjb3JkRHVyYXRpb246IG51bWJlciA9IDI1MDA7XG4gICAgc3RhdGljIGJ1ZmZlcnNSZWFkeTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgc3RhdGljIG91ckJ1ZmZlcj86IEZsb2F0MzJBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7XG4gICAgc3RhdGljIHRoZWlyQnVmZmVyPzogRmxvYXQzMkFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSgxKTtcbiAgICBzdGF0aWMgaW5SZWNvcmRpbmdGbGlnaHQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIHN0YXRpYyBjdXJyZW50TWFzdGVyOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHNldHVwXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHNldHVwICgpIHtcblxuICAgICAgICBLaWt1LnBlZXJDb25uU3RhY2sgPSBuZXcgQXJyYXkoMCk7XG4gICAgICAgIEtpa3UuYWN0aXZlQ29ubiA9IDA7XG5cbiAgICAgICAgaWYgKCg8YW55PndpbmRvdykuUGVlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBLaWt1LnBlZXJqcyA9ICg8YW55PndpbmRvdykuUGVlcjtcbiAgICAgICAgfVxuXG4gICAgICAgIEtpa3VBdWRpb1N0cmVhbS5zZXR1cCgpO1xuICAgICAgICBLaWt1QXVkaW9TdHJlYW0ubGlzdGVuRm9yU3RhcnQoS2lrdS5vblN0YXJ0UmVjb3JkaW5nKTtcbiAgICAgICAgXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBjb25uZWN0VG9TZXJ2ZXJcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBuYW1lIDogTmFtZSBvZiB0aGUgcGVlciBvbiB0aGlzIGRldmljZVxuICAgICAqIEBwYXJhbSBzZXJ2ZXJBZGRyIDogU2VydmVyIElQIGxvY2F0aW9uXG4gICAgICogQHBhcmFtIHNlcnZlclBvcnQgOiBTZXJ2ZXIgcG9ydFxuICAgICAqIEBwYXJhbSBzZXJ2ZXJQYXRoIDogUGVlcmpzIHNlcnZlciBwYXRoXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBjb25uZWN0VG9TZXJ2ZXIgKG5hbWU6IHN0cmluZywgc2VydmVyQWRkcjogc3RyaW5nLCBzZXJ2ZXJQb3J0OiBzdHJpbmcsIHNlcnZlclBhdGg6c3RyaW5nKSB7XG5cbiAgICAgICAgLy8gU2V0dXAgcHJvcGVydGllc1xuICAgICAgICBLaWt1Lm15bmFtZSA9IG5hbWU7XG4gICAgICAgIEtpa3Uuc2VydmVyQWRkciA9IHNlcnZlckFkZHI7XG4gICAgICAgIEtpa3Uuc2VydmVyUG9ydCA9IHNlcnZlclBvcnQ7XG4gICAgICAgIEtpa3Uuc2VydmVyUGF0aCA9IHNlcnZlclBhdGg7XG5cbiAgICAgICAgLy8gRm9ybWF0IGZvciBwZWVyanNcbiAgICAgICAgbGV0IHNlcnZlckluZm86IE9iamVjdCA9IHtcbiAgICAgICAgICAgIGhvc3Q6IEtpa3Uuc2VydmVyQWRkcixcbiAgICAgICAgICAgIHBvcnQ6IEtpa3Uuc2VydmVyUG9ydCxcbiAgICAgICAgICAgIHBhdGg6IEtpa3Uuc2VydmVyUGF0aFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIENvbm5lY3QgdG8gc2VydmVyXG4gICAgICAgIEtpa3UucGVlciA9IG5ldyBLaWt1LnBlZXJqcyhLaWt1Lm15bmFtZSwgc2VydmVySW5mbyk7IFxuXG4gICAgICAgIC8vIEFzc2lnbiBjYWxsYmFja3MgdG8gcGVlciBvYmplY3RcbiAgICAgICAgS2lrdS5wZWVyLm9uKCdjb25uZWN0aW9uJywgKGNvbm46IGFueSkgPT4ge1xuICAgICAgICAgICAgS2lrdS5vbkNvbm5lY3Rpb25DYWxsYmFjayhjb25uKTtcbiAgICAgICAgICAgIGNvbm4ub24oJ2RhdGEnLCAobWVzc2FnZTogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgS2lrdS5vbkRhdGFDYWxsYmFjayhjb25uLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGNvbm5lY3RUb0RldmljZVxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIGRldmljZU5hbWUgXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBjb25uZWN0VG9EZXZpY2UgKGRldmljZU5hbWU6IHN0cmluZykge1xuXG4gICAgICAgIC8vIENvbm5lY3QgdG8gcGVlclxuICAgICAgICBsZXQgcGVlckNvbm4gPSBLaWt1LnBlZXIuY29ubmVjdChkZXZpY2VOYW1lKTtcblxuICAgICAgICAvLyBTZXR1cCBjYWxsYmFja3MgYmVmb3JlIGFkZGluZyB0byB0aGUgc3RhY2tcbiAgICAgICAgcGVlckNvbm4ub24oJ29wZW4nLCAoKSA9PiB7XG4gICAgICAgICAgICBwZWVyQ29ubi5vbignZGF0YScsIChtZXNzYWdlOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICBLaWt1Lm9uRGF0YUNhbGxiYWNrKHBlZXJDb25uLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQWRkIG9udG8gdGhlIGNvbm5lY3Rpb24gc3RhY2tcbiAgICAgICAgS2lrdS5wZWVyQ29ublN0YWNrLnB1c2gocGVlckNvbm4pO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZW5kRW1wdHlSZXNwb25zZVxuICAgICAqIEBwYXJhbSBkZXZpY2VOYW1lIDogTmFtZSBvZiBkZXZpY2UgdG8gc2VuZCBtZXNzYWdlIHRvXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBzZW5kRW1wdHlSZXNwb25zZSAoZGV2aWNlTmFtZTogc3RyaW5nKSB7XG5cbiAgICAgICAgbGV0IHN0YWNrSW5kZXggPSBLaWt1LmZpbmRJbmRleE9mRGV2aWNlKGRldmljZU5hbWUpO1xuXG4gICAgICAgIGlmIChzdGFja0luZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBuZXcgTWVzc2FnZURhdGEoTWVzc2FnZVR5cGUuUkVRVUVTVF9FTVBUWV9SRVNQT05TRSk7XG4gICAgICAgICAgICBpZiAoS2lrdS5wZWVyQ29ublN0YWNrW3N0YWNrSW5kZXhdLm9wZW4pe1xuICAgICAgICAgICAgICAgIEtpa3Uub3VyTmV0d29ya1RpbWUgPSBLaWt1LmN1cnJlbnRUaW1lKCk7XG4gICAgICAgICAgICAgICAgUGVlckNvbm5lY3Rpb24uc2VuZERhdGEoS2lrdS5wZWVyQ29ublN0YWNrW3N0YWNrSW5kZXhdLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDb25uZWN0aW9uIHRvIHBlZXIgd2FzIG5vdCBvcGVuIHRvIHNlbmQgdGhlIGRhdGEgdmlhIScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdObyBwZWVyIHdpdGggdGhhdCBJRCB3YXMgZm91bmQgaW4gdGhlIGFjdGl2ZSBjb25uZWN0aW9uIHN0YWNrIScpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHN0YXJ0UmVjb3JkaW5nXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gZGV2aWNlTmFtZSA6IERldmljZSB0byByZXF1ZXN0IHN5bmNocm9uaXplZCByZWNvcmRpbmdcbiAgICAgKiBAcGFyYW0gZnJvbU5vdyA6IE51bWJlciBvZiBtaWxpc2Vjb25kcyB0byBzdGFydCBmcm9tIG5vd1xuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgc3RhcnRSZWNvcmRpbmcgKGRldmljZU5hbWU6IHN0cmluZywgZnJvbU5vdzogbnVtYmVyKSB7XG5cbiAgICAgICAgS2lrdS5jdXJyZW50TWFzdGVyID0gdHJ1ZTtcblxuICAgICAgICBLaWt1LmluUmVjb3JkaW5nRmxpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgS2lrdS5hY3RpdmVDb25uID0gS2lrdS5maW5kSW5kZXhPZkRldmljZShkZXZpY2VOYW1lKTtcblxuICAgICAgICBsZXQgdGltZVN0YW1wID0gcGVyZm9ybWFuY2UudGltZU9yaWdpbiArIHBlcmZvcm1hbmNlLm5vdygpICsgZnJvbU5vdztcblxuICAgICAgICBsZXQgc3RhY2tJbmRleCA9IEtpa3UuZmluZEluZGV4T2ZEZXZpY2UoZGV2aWNlTmFtZSk7XG5cbiAgICAgICAgaWYgKHN0YWNrSW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBsZXQgbWVzc2FnZSA9IG5ldyBNZXNzYWdlRGF0YShNZXNzYWdlVHlwZS5SRVFVRVNUX1JFQ09SRCwgdGltZVN0YW1wKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTZW5kaW5nIHN0YXJ0IHJlY29yZCBtZXNzYWdlJywgbWVzc2FnZSk7XG4gICAgICAgICAgICBpZiAoS2lrdS5wZWVyQ29ublN0YWNrW3N0YWNrSW5kZXhdLm9wZW4pXG4gICAgICAgICAgICAgICAgUGVlckNvbm5lY3Rpb24uc2VuZERhdGEoS2lrdS5wZWVyQ29ublN0YWNrW3N0YWNrSW5kZXhdLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignQ29ubmVjdGlvbiB0byBwZWVyIHdhcyBub3Qgb3BlbiB0byBzZW5kIHRoZSBkYXRhIHZpYSEnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignTm8gcGVlciB3aXRoIHRoYXQgSUQgd2FzIGZvdW5kIGluIHRoZSBhY3RpdmUgY29ubmVjdGlvbiBzdGFjayEnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBidWZmZXIgPSBhd2FpdCBLaWt1QXVkaW9TdHJlYW0ucmVjb3JkQXQodGltZVN0YW1wLCBLaWt1LnJlY29yZER1cmF0aW9uKTtcbiAgICAgICAgS2lrdS5vdXJCdWZmZXIgPSA8RmxvYXQzMkFycmF5PmJ1ZmZlcjtcbiAgICAgICAgS2lrdS5jdXJyZW50TWFzdGVyID0gZmFsc2U7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlICgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT4ge1xuICAgICAgICAgICAgICAgIGlmIChLaWt1LmluUmVjb3JkaW5nRmxpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCgnUmVjb3JkaW5nIHdhcyBzdGlsbCBpbiBmbGlnaHQgYW5kIHdhcyBub3QgdHJhbnNmZXJlZCBiYWNrIHRvIHRoaXMgZGV2aWNlIGluIHRpbWUnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcmVzdWx0cyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnREZXZpY2VCdWZmZXI6IEtpa3Uub3VyQnVmZmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGVkRGV2aWNlQnVmZmVyOiBLaWt1LnRoZWlyQnVmZmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3JkaW5nRGVsYXk6IEtpa3UucmVjb3JkaW5nRGVsYXlUaW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV0d29ya0RlbGF5OiBLaWt1Lm5ldHdvcmtEZWxheVRpbWVcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSAocmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgS2lrdS5mbGlnaHRBbGxvd2FuY2VUaW1lKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZW5kUmVjb3JkZWRCdWZmZXJcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBkZXZpY2VOYW1lIDogRGV2aWNlIHRvIHNlbmQgcmVjb3JkZWQgYnVmZmVyIHRvXG4gICAgICogQHBhcmFtIGJ1ZmZlciA6IEF1ZGlvIGJ1ZmZlciB0byBzZW5kXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBzZW5kUmVjb3JkZWRCdWZmZXIgKGRldmljZU5hbWU6IHN0cmluZywgYnVmZmVyOiBGbG9hdDMyQXJyYXkpIHtcbiAgICAgICAgbGV0IHN0YWNrSW5kZXggPSBLaWt1LmZpbmRJbmRleE9mRGV2aWNlKGRldmljZU5hbWUpO1xuXG4gICAgICAgIGlmIChzdGFja0luZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBuZXcgTWVzc2FnZURhdGEoTWVzc2FnZVR5cGUuUkVTUE9OU0VfUkVDT1JELCBLaWt1LmN1cnJlbnRUaW1lKCksIGJ1ZmZlcik7XG4gICAgICAgICAgICBpZiAoS2lrdS5wZWVyQ29ublN0YWNrW3N0YWNrSW5kZXhdLm9wZW4pXG4gICAgICAgICAgICAgICAgUGVlckNvbm5lY3Rpb24uc2VuZERhdGEoS2lrdS5wZWVyQ29ublN0YWNrW3N0YWNrSW5kZXhdLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignQ29ubmVjdGlvbiB0byBwZWVyIHdhcyBub3Qgb3BlbiB0byBzZW5kIHRoZSBkYXRhIHZpYSEnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignTm8gcGVlciB3aXRoIHRoYXQgSUQgd2FzIGZvdW5kIGluIHRoZSBhY3RpdmUgY29ubmVjdGlvbiBzdGFjayEnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgb25TdGFydFJlY29yZGluZ1xuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIG9uU3RhcnRSZWNvcmRpbmcgKCkge1xuICAgICAgICBpZiAoS2lrdS5jdXJyZW50TWFzdGVyICE9PSB0cnVlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnb25TdGFydFJlY29yZGluZyBlbnRlcmluZyBzZW5kIG1lc3NhZ2UnKTtcbiAgICAgICAgICAgIEtpa3Uub3VyUmVjb3JkaW5nU3RhcnQgPSBLaWt1LmN1cnJlbnRUaW1lKCk7XG4gICAgICAgICAgICBsZXQgbWVzc2FnZSA9IG5ldyBNZXNzYWdlRGF0YShNZXNzYWdlVHlwZS5TVEFSVEVEX1JFQ09SRElORyk7XG4gICAgICAgICAgICBpZiAoS2lrdS5wZWVyQ29ublN0YWNrW0tpa3UuYWN0aXZlQ29ubl0ub3Blbil7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1NlbmRpbmcgbWVzc2FnZSBvZiBzdGFydCByZWNvcmRpbmcnLCBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICBQZWVyQ29ubmVjdGlvbi5zZW5kRGF0YShLaWt1LnBlZXJDb25uU3RhY2tbS2lrdS5hY3RpdmVDb25uXSwgbWVzc2FnZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignQ29ubmVjdGlvbiB0byBwZWVyIHdhcyBub3Qgb3BlbiB0byBzZW5kIHRoZSBkYXRhIHZpYSEnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgc2V0UmV0dXJuQWxsb3dhbmNlXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gYWxsb3dhbmNlIDogUmV0dXJuIHRpbWUgYWxsb3dhbmNlIGJlZm9yZSB0aW1lb3V0IHdoZW4gd2FpdGluZyBmb3Igb3RoZXIgZGV2aWNlIGJ1ZmZlclxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgc2V0UmV0dXJuQWxsb3dhbmNlIChhbGxvd2FuY2U6IG51bWJlcikge1xuICAgICAgICBLaWt1LmZsaWdodEFsbG93YW5jZVRpbWUgPSBhbGxvd2FuY2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBkZWxldGVVbnVzZWRDb25uZWN0aW9uc1xuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBkZWxldGVVbnVzZWRDb25uZWN0aW9ucyAoKSB7XG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBLaWt1LnBlZXJDb25uU3RhY2subGVuZ3RoOyBpbmRleCsrKXtcbiAgICAgICAgICAgIGlmICghS2lrdS5wZWVyQ29ublN0YWNrW2luZGV4XS5vcGVuKXtcbiAgICAgICAgICAgICAgICBLaWt1LnBlZXJDb25uU3RhY2suc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZmluZEluZGV4T2ZEZXZpY2VcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0gZGV2aWNlTmFtZSA6IERldmljZSBpZCB0byBzZWFyY2ggaW4gdGhlIGNvbm5lY3Rpb24gc3RhY2tcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBmaW5kSW5kZXhPZkRldmljZSAoZGV2aWNlTmFtZTogc3RyaW5nKSA6IG51bWJlciB7XG5cbiAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IEtpa3UucGVlckNvbm5TdGFjay5sZW5ndGg7IGluZGV4Kyspe1xuICAgICAgICAgICAgaWYgKEtpa3UucGVlckNvbm5TdGFja1tpbmRleF0ucGVlciA9PT0gZGV2aWNlTmFtZSl7ICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIG9uRGF0YUNhbGxiYWNrXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIGNvbm4gOiBQZWVyanMgY29ubmVjdGlvbiB0byBwYXNzIGluXG4gICAgICogQHBhcmFtIG1lc3NhZ2UgOiBNZXNzYWdlIHJlY2VpdmVkIG9uIHRoZSBjb25uZWN0aW9uXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgb25EYXRhQ2FsbGJhY2sgKGNvbm46IGFueSwgbWVzc2FnZTogYW55KSB7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ21lc3NhZ2UgcmVjZWl2ZWQ6JywgbWVzc2FnZSk7XG5cbiAgICAgICAgc3dpdGNoIChtZXNzYWdlLnR5cGUpIHtcblxuICAgICAgICAgICAgY2FzZSAoTWVzc2FnZVR5cGUuUkVRVUVTVF9FTVBUWV9SRVNQT05TRSk6XG4gICAgICAgICAgICAgICAgbGV0IGVtcHR5UmVzcG9uc2UgPSBuZXcgTWVzc2FnZURhdGEoTWVzc2FnZVR5cGUuUkVTUE9OU0VfRU1QVFlfUkVTUE9OU0UpO1xuICAgICAgICAgICAgICAgIEtpa3Uub3VyTmV0d29ya1RpbWUgPSBLaWt1LmN1cnJlbnRUaW1lKCk7XG4gICAgICAgICAgICAgICAgUGVlckNvbm5lY3Rpb24uc2VuZERhdGEoY29ubiwgZW1wdHlSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgKE1lc3NhZ2VUeXBlLlJFUVVFU1RfUkVDT1JEKTpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQXNrZWQgdG8gc3RhcnQgcmVjb3JkaW5nLi4uJylcbiAgICAgICAgICAgICAgICBLaWt1QXVkaW9TdHJlYW0ucmVjb3JkQXQobWVzc2FnZS50aW1lU3RhbXAsIEtpa3UucmVjb3JkRHVyYXRpb24pLnRoZW4oKGJ1ZmZlcjogYW55KT0+e1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU3VjY2Vzc2Z1bGx5IGNvbXBsZXRlZCByZWNvcmRpbmchJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZFJlY29yZGVkQnVmZmVyKGNvbm4ucGVlciwgYnVmZmVyKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIChNZXNzYWdlVHlwZS5TVEFSVEVEX1JFQ09SRElORyk6XG4gICAgICAgICAgICAgICAgS2lrdS50aGVpclJlY29yZGluZ1N0YXJ0ID0gS2lrdS5jdXJyZW50VGltZSgpO1xuICAgICAgICAgICAgICAgIEtpa3UudXBkYXRlUmVjb3JkaW5nRGVsYXlUaW1lKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgKE1lc3NhZ2VUeXBlLlJFU1BPTlNFX0VNUFRZX1JFU1BPTlNFKTpcbiAgICAgICAgICAgICAgICBLaWt1LnRoZWlyTmV0d29ya1RpbWUgPSBLaWt1LmN1cnJlbnRUaW1lKCk7XG4gICAgICAgICAgICAgICAgS2lrdS51cGRhdGVOZXR3b3JrRGVsYXlUaW1lKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgKE1lc3NhZ2VUeXBlLlJFU1BPTlNFX1JFQ09SRCk6XG4gICAgICAgICAgICAgICAgS2lrdS50aGVpckJ1ZmZlciA9IG1lc3NhZ2UuYXVkaW9CdWZmZXI7XG4gICAgICAgICAgICAgICAgS2lrdS5pblJlY29yZGluZ0ZsaWdodCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgb25Db25uZWN0aW9uQ2FsbGJhY2tcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0gY29ubiA6IFBlZXJqcyBjb25uZWN0aW9uXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgb25Db25uZWN0aW9uQ2FsbGJhY2sgKGNvbm46IGFueSkge1xuICAgICAgICBjb25zb2xlLmxvZygnQ29ubmVjdGlvbiByZWNlaXZlZCEnLCBjb25uKTtcbiAgICAgICAgS2lrdS5wZWVyQ29ublN0YWNrLnB1c2goY29ubik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBvbk9wZW5DYWxsYmFja1xuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIG9uT3BlbkNhbGxiYWNrICgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0Nvbm5lY3Rpb24gb3BlbiEnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGN1cnJlbnRUaW1lXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgY3VycmVudFRpbWUgKCkgOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCArIHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgdXBkYXRlTmV0d29ya0RlbGF5VGltZVxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIHVwZGF0ZU5ldHdvcmtEZWxheVRpbWUgKCkge1xuICAgICAgICBLaWt1Lm91ck5ldHdvcmtUaW1lID0gS2lrdS5vdXJOZXR3b3JrVGltZSB8fCBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgS2lrdS50aGVpck5ldHdvcmtUaW1lID0gS2lrdS50aGVpck5ldHdvcmtUaW1lIHx8IEtpa3Uub3VyTmV0d29ya1RpbWU7XG4gICAgICAgIEtpa3UubmV0d29ya0RlbGF5VGltZSA9IE1hdGguYWJzKEtpa3Uub3VyTmV0d29ya1RpbWUgLSBLaWt1LnRoZWlyTmV0d29ya1RpbWUpLzI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB1cGRhdGVSZWNvcmRpbmdEZWxheVRpbWVcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyB1cGRhdGVSZWNvcmRpbmdEZWxheVRpbWUgKCkge1xuICAgICAgICBLaWt1LnJlY29yZGluZ0RlbGF5VGltZSA9IE1hdGguYWJzKEtpa3Uub3VyUmVjb3JkaW5nU3RhcnQgLSBLaWt1LnRoZWlyUmVjb3JkaW5nU3RhcnQpLzI7XG4gICAgfVxuXG59XG5cbi8qKlxuICogQGNsYXNzIFBlZXJDb25uZWN0aW9uXG4gKi9cbmNsYXNzIFBlZXJDb25uZWN0aW9uIHtcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgc2VuZERhdGFcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBjb25uIDogUGVlcmpzIGNvbm5lY3Rpb24gb2JqZWN0XG4gICAgICogQHBhcmFtIG1lc3NhZ2VEYXRhIDogTWVzc2FnZURhdGEgb2JqZWN0IHdpdGggZGF0YSB0byBzZW5kXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBzZW5kRGF0YSAoY29ubjogYW55LCBtZXNzYWdlRGF0YTogTWVzc2FnZURhdGEpIHtcblxuICAgICAgICBsZXQgbWVzc2FnZTogT2JqZWN0ID0ge1xuICAgICAgICAgICAgdHlwZTogbWVzc2FnZURhdGEudHlwZSxcbiAgICAgICAgICAgIHRpbWVTdGFtcDogbWVzc2FnZURhdGEudGltZVN0YW1wIHx8ICcnLFxuICAgICAgICAgICAgYXVkaW9CdWZmZXI6IG1lc3NhZ2VEYXRhLmF1ZGlvQnVmZmVyIHx8ICcnXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGNvbm4uX29wZW4pIHtcbiAgICAgICAgICAgIGNvbm4uc2VuZChtZXNzYWdlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignVHJpZWQgdG8gc2VuZCBtZXNzYWdlIHdoZW4gY29ubmVjdGlvbiBpcyBjbG9zZWQhJywgbWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogQGNsYXNzIE1lc3NhZ2VEYXRhXG4gKi9cbmNsYXNzIE1lc3NhZ2VEYXRhIHtcblxuICAgIHR5cGU6IHN0cmluZztcbiAgICB0aW1lU3RhbXA/OiBudW1iZXI7XG4gICAgYXVkaW9CdWZmZXI/OiBGbG9hdDMyQXJyYXk7XG5cbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0gbWVzc2FnZVR5cGUgOiBNZXNzYWdlIHR5cGUgdG8gc2VuZCBvZiB0eXBlIGVudW0gTWVzc2FnZVR5cGVcbiAgICAgKiBAcGFyYW0gdGltZVN0YW1wIDogVGltaW5nIGluZm9ybWF0aW9uIHJlbGF0ZWQgdG8gdGhlIG1lc3NhZ2VcbiAgICAgKiBAcGFyYW0gYXVkaW9CdWZmZXIgOiBBdWRpbyBidWZmZXIgdG8gc2VuZFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yIChtZXNzYWdlVHlwZTogc3RyaW5nLCB0aW1lU3RhbXA/OiBudW1iZXIsIGF1ZGlvQnVmZmVyPzogRmxvYXQzMkFycmF5KSB7XG4gICAgICAgIHRoaXMudHlwZSA9IG1lc3NhZ2VUeXBlO1xuICAgICAgICB0aGlzLnRpbWVTdGFtcCA9IHRpbWVTdGFtcDtcbiAgICAgICAgdGhpcy5hdWRpb0J1ZmZlciA9IGF1ZGlvQnVmZmVyO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgdG9PYmplY3RcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgcHVibGljIHRvT2JqZWN0ICgpIDogT2JqZWN0IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG1lc3NhZ2VUeXBlOiB0aGlzLnR5cGUsXG4gICAgICAgICAgICB0aW1lU3RhbXA6IHRoaXMudGltZVN0YW1wIHx8IFtdLFxuICAgICAgICAgICAgYXVkaW9CdWZmZXI6IHRoaXMuYXVkaW9CdWZmZXIgfHwgW11cbiAgICAgICAgfTtcbiAgICB9XG5cbn1cblxuLyoqXG4gKiBAZW51bSBNZXNzYWdlVHlwZVxuICovXG5lbnVtIE1lc3NhZ2VUeXBlIHtcblxuICAgIFJFUVVFU1RfUkVDT1JEID0gJ3JlcXVlc3RSZWNvcmQnLFxuICAgIFJFU1BPTlNFX1JFQ09SRCA9ICdyZXNwb25zZVJlY29yZCcsXG5cbiAgICBTVEFSVEVEX1JFQ09SRElORyA9ICdzdGFydGVkUmVjb3JkaW5nJyxcbiAgICBTVE9QUEVEX1JFQ09SRElORyA9ICdzdG9wcGVkUmVjb3JkaW5nJyxcblxuICAgIFJFUVVFU1RfRU1QVFlfUkVTUE9OU0UgPSAncmVxdWVzdEVtcHR5UmVzcG9uc2UnLFxuICAgIFJFU1BPTlNFX0VNUFRZX1JFU1BPTlNFID0gJ3Jlc3BvbnNlRW1wdHlSZXNwb25zZSdcblxufVxuXG4vLyBBc3NpZ24gdG8gd2luZG93IGZvciBlYXN5IEpTIHN0YXJ0dXBcbig8YW55PndpbmRvdykuS2lrdSA9IEtpa3U7XG4iLCJkZWNsYXJlIHZhciBNZWRpYVJlY29yZGVyOiBhbnk7XG5cbi8qKlxuICogQGNsYXNzIEtpa3VBdWRpb1N0cmVhbVxuICovXG5leHBvcnQgY2xhc3MgS2lrdUF1ZGlvU3RyZWFtIHtcblxuICAgIHN0YXRpYyBpc1JlY29yZGluZzogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHN0YXRpYyBhY3RpdmVCdWZmZXI6IEZsb2F0MzJBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7XG4gICAgc3RhdGljIHJlY29yZGVkQnVmZmVyOiBGbG9hdDMyQXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KDEpO1xuXG4gICAgcHVibGljIHN0YXRpYyBzdGFydGVkUmVjb3JkaW5nOiBGdW5jdGlvbiA9ICgpID0+IHt9O1xuICAgIHB1YmxpYyBzdGF0aWMgZmluaXNoZWRSZWNvcmRpbmc6IEZ1bmN0aW9uID0gKCkgPT4ge307XG5cbiAgICBzdGF0aWMgYXVkaW9Db250ZXh0OiBBdWRpb0NvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KCkgfHwgKDxhbnk+d2luZG93KS53ZWJraXRBdWRpb0NvbnRleHQoKTtcbiAgICBzdGF0aWMgc2NyaXB0Tm9kZT86IFNjcmlwdFByb2Nlc3Nvck5vZGU7XG4gICAgc3RhdGljIG1lZGlhU3RyZWFtU291cmNlTm9kZT86IE1lZGlhU3RyZWFtQXVkaW9Tb3VyY2VOb2RlO1xuXG4gICAgc3RhdGljIG1pY1JlY29yZGVyPzogTWVkaWFTdHJlYW07XG5cbiAgICBzdGF0aWMgc3VwcG9ydGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIHN0YXRpYyByZXNldEF1ZGlvQnVmZmVyOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHNldHVwXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHNldHVwICgpIHtcblxuICAgICAgICBpZiAobmF2aWdhdG9yLm1lZGlhRGV2aWNlcyAmJiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSkge1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZ2V0VXNlck1lZGlhIHN1cHBvcnRlZC4nKTtcbiAgICAgICAgICAgIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhIChcbiAgICAgICAgICAgICAgIDxhbnk+e1xuICAgICAgICAgICAgICAgIFwiYXVkaW9cIjoge1xuICAgICAgICAgICAgICAgICAgICBcIm1hbmRhdG9yeVwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImdvb2dFY2hvQ2FuY2VsbGF0aW9uXCI6IFwiZmFsc2VcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZ29vZ0F1dG9HYWluQ29udHJvbFwiOiBcImZhbHNlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImdvb2dOb2lzZVN1cHByZXNzaW9uXCI6IFwiZmFsc2VcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZ29vZ0hpZ2hwYXNzRmlsdGVyXCI6IFwiZmFsc2VcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBcIm9wdGlvbmFsXCI6IFtdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgfSkgLy8gUmVxdWVzdCBwZXJtaXNzaW9uc1xuICAgICAgICAgXG4gICAgICAgICAgICAgICAvLyBTdWNjZXNzIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoc3RyZWFtKSB7XG4gICAgICAgICAgICAgICAgICAgIEtpa3VBdWRpb1N0cmVhbS5zZXR1cFN0cmVhbShzdHJlYW0pO1xuICAgICAgICAgICAgICAgfSlcbiAgICAgICAgIFxuICAgICAgICAgICAgICAgLy8gRXJyb3IgY2FsbGJhY2tcbiAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignVGhlIGZvbGxvd2luZyBnZXRVc2VyTWVkaWEgZXJyb3Igb2NjdXJlZDogJyArIGVycik7XG4gICAgICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICApO1xuICAgIFxuICAgICAgICAgfSBlbHNlIHsgLy8gTWVkaWEgZGV2aWNlcyB3ZXJlbid0IGF2YWlsYWJsZVxuICAgICAgICAgICAgY29uc29sZS53YXJuKCdnZXRVc2VyTWVkaWEgbm90IHN1cHBvcnRlZCBvbiB5b3VyIGJyb3dzZXIhJyk7XG4gICAgICAgICB9XG5cblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgbGlzdGVuRm9yU3RhcnRcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBjYWxsYmFjayA6IENhbGxiYWNrIHRvIGNhbGwgb24gdGhlIHN0YXJ0IG9mIHJlY29yZGluZ1xuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgbGlzdGVuRm9yU3RhcnQgKGNhbGxiYWNrOiBGdW5jdGlvbikge1xuICAgICAgICB0aGlzLnN0YXJ0ZWRSZWNvcmRpbmcgPSBjYWxsYmFjaztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGxpc3RlbkZvckVuZFxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIGNhbGxiYWNrIDogQ2FsbGJhY2sgdG8gY2FsbCBvbiB0aGUgZW5kIG9mIHJlY29yZGluZ1xuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgbGlzdGVuRm9yRW5kIChjYWxsYmFjazogRnVuY3Rpb24pIHtcbiAgICAgICAgdGhpcy5maW5pc2hlZFJlY29yZGluZyA9IGNhbGxiYWNrO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZmxvYXQzMmJ1ZmZlckNvbmNhdFxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBidWZmZXIwIFxuICAgICAqIEBwYXJhbSBidWZmZXIxIFxuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIGZsb2F0MzJidWZmZXJDb25jYXQgKGJ1ZmZlcjA6IEZsb2F0MzJBcnJheSwgYnVmZmVyMTogRmxvYXQzMkFycmF5KSB7XG5cbiAgICAgICAgbGV0IGl0ZW0wTGVuZ3RoID0gYnVmZmVyMC5sZW5ndGg7XG4gICAgICAgIGxldCByZXN1bHQgPSBuZXcgRmxvYXQzMkFycmF5KGl0ZW0wTGVuZ3RoICsgYnVmZmVyMS5sZW5ndGgpO1xuICAgIFxuICAgICAgICByZXN1bHQuc2V0KGJ1ZmZlcjApO1xuICAgICAgICByZXN1bHQuc2V0KGJ1ZmZlcjEsIGl0ZW0wTGVuZ3RoKTtcbiAgICBcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgc2V0dXBTdHJlYW1cbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0gc3RyZWFtIDogTWVkaWEgc3RyZWFtIHRvIHNldHVwIGF1ZGlvIHJlY29yZGluZyBcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBzZXR1cFN0cmVhbSAoc3RyZWFtOiBNZWRpYVN0cmVhbSkge1xuXG4gICAgICAgIC8vIFVwZGF0ZSBzdHJlYW0gaW5mb1xuICAgICAgICBLaWt1QXVkaW9TdHJlYW0uc3VwcG9ydGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5taWNSZWNvcmRlciA9IG5ldyBNZWRpYVJlY29yZGVyKHN0cmVhbSk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGxpdmUgYXVkaW8gY29udGV4dCBwcm9jZXNzaW5nXG4gICAgICAgIEtpa3VBdWRpb1N0cmVhbS5zY3JpcHROb2RlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlU2NyaXB0UHJvY2Vzc29yKDEwMjQsIDEsIDEpO1xuICAgICAgICBLaWt1QXVkaW9TdHJlYW0ubWVkaWFTdHJlYW1Tb3VyY2VOb2RlID0gdGhpcy5hdWRpb0NvbnRleHQuY3JlYXRlTWVkaWFTdHJlYW1Tb3VyY2Uoc3RyZWFtKTtcblxuICAgICAgICAvLyBDYWxsYmFjayBmb3Igc2NyaXB0IHByb2Nlc3NvciBmdW5jdGlvblxuICAgICAgICBLaWt1QXVkaW9TdHJlYW0uc2NyaXB0Tm9kZS5vbmF1ZGlvcHJvY2VzcyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgICAgICAgIC8vIEFkZCBvbnRvIHJlY29yZGVkIGRhdGEgd2hlbiBzZXQgdG8gdHJ1ZVxuICAgICAgICAgICAgaWYoS2lrdUF1ZGlvU3RyZWFtLmlzUmVjb3JkaW5nKSB7XG4gICAgICAgICAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLmFjdGl2ZUJ1ZmZlciA9IEtpa3VBdWRpb1N0cmVhbS5mbG9hdDMyYnVmZmVyQ29uY2F0KEtpa3VBdWRpb1N0cmVhbS5hY3RpdmVCdWZmZXIsIGV2ZW50LmlucHV0QnVmZmVyLmdldENoYW5uZWxEYXRhKDApKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKEtpa3VBdWRpb1N0cmVhbS5yZXNldEF1ZGlvQnVmZmVyID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlc2V0IG1lbW9yeSBmb3IgZ2FyYmFnZSBjb2xsZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgIEtpa3VBdWRpb1N0cmVhbS5hY3RpdmVCdWZmZXIgPSBuZXcgRmxvYXQzMkFycmF5KDEpO1xuICAgICAgICAgICAgICAgICAgICBLaWt1QXVkaW9TdHJlYW0ucmVzZXRBdWRpb0J1ZmZlciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIENvbm5lY3Qgc291cmNlIHRvIHNjcmlwdCBwcm9jZXNzb3JcbiAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLm1lZGlhU3RyZWFtU291cmNlTm9kZS5jb25uZWN0KEtpa3VBdWRpb1N0cmVhbS5zY3JpcHROb2RlKTtcbiAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLnNjcmlwdE5vZGUuY29ubmVjdChLaWt1QXVkaW9TdHJlYW0uYXVkaW9Db250ZXh0LmRlc3RpbmF0aW9uKTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgcmVjb3JkQXRcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSB0aW1lIDogVGltZSB0byBzdGFydCByZWNvcmRpbmcgYXQgKHVuaXggdGltZSlcbiAgICAgKiBAcGFyYW0gZHVyYXRpb24gOiBEdXJhdGlvbiB0byByZWNvcmQgZm9yIChtcylcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIHJlY29yZEF0ICh0aW1lOiBudW1iZXIsIGR1cmF0aW9uOiBudW1iZXIpIHtcblxuICAgICAgICAvLyBFc3RpbWF0ZSBleGVjdXRpb24gdGltZVxuICAgICAgICBsZXQgZXRhX21zID0gdGltZSAtIEtpa3VBdWRpb1N0cmVhbS5jdXJyZW50VGltZSgpO1xuICAgICAgICBjb25zb2xlLmxvZygnU3RhcnRpbmcgdG8gcmVjb3JkIGluICcgKyBldGFfbXMgKyAnIGZyb20gbm93ICgnICsgZXRhX21zLzEwMDAgKyAnKScpO1xuXG4gICAgICAgIC8vIERlY2xhcmUgY2FsbGJhY2sgdW50aWwgZXhlY3V0aW9uIHRpbWVcbiAgICAgICAgbGV0IHdhaXRVbnRpbCA9ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSAoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57XG4gICAgICAgICAgICAgICAgICAgIEtpa3VBdWRpb1N0cmVhbS5yZWNvcmQoZHVyYXRpb24pLnRoZW4oKHJlY29yZGluZyk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVjb3JkaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9LCBldGFfbXMpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBXYWl0IHVudGlsIGV4ZWN1dGlvbiB0aW1lXG4gICAgICAgIGxldCByZWNvcmRpbmcgPSBhd2FpdCB3YWl0VW50aWwoKTtcblxuICAgICAgICAvLyBSZXR1cm4gcmVjb3JkZWQgYnVmZmVyXG4gICAgICAgIHJldHVybiByZWNvcmRpbmc7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHJlY29yZFxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIGR1cmF0aW9uIDogTGVuZ3RoIHRvIHJlY29yZCBmb3IgKG1zKVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcmVjb3JkIChkdXJhdGlvbjogbnVtYmVyKSB7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlICgocmVzb2x2ZSkgPT4ge1xuXG4gICAgICAgICAgICAvLyBTZXQgcmVjb3JkIGF0b21pYyBib29sZWFuIHRydWVcbiAgICAgICAgICAgIEtpa3VBdWRpb1N0cmVhbS5pc1JlY29yZGluZyA9IHRydWU7XG5cbiAgICAgICAgICAgIC8vIE5vdGlmeSBsaXN0ZW5lcnNcbiAgICAgICAgICAgIEtpa3VBdWRpb1N0cmVhbS5zdGFydGVkUmVjb3JkaW5nKCk7XG5cbiAgICAgICAgICAgIC8vIFRpbWVvdXQgdW50aWwgZmluaXNoXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57XG4gICAgICAgICAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLmlzUmVjb3JkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLnJlY29yZGVkQnVmZmVyID0gS2lrdUF1ZGlvU3RyZWFtLmFjdGl2ZUJ1ZmZlcjtcbiAgICAgICAgICAgICAgICByZXNvbHZlKEtpa3VBdWRpb1N0cmVhbS5yZWNvcmRlZEJ1ZmZlcik7XG4gICAgICAgICAgICB9LCBkdXJhdGlvbik7XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCByZWNvcmRpbmdcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcmVjb3JkaW5nICgpIDogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBLaWt1QXVkaW9TdHJlYW0uaXNSZWNvcmRpbmc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBnZXRMYXN0UmVjb3JkZWRCdWZmZXJcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZ2V0TGFzdFJlY29yZGVkQnVmZmVyICgpIDogRmxvYXQzMkFycmF5IHtcbiAgICAgICAgcmV0dXJuIEtpa3VBdWRpb1N0cmVhbS5yZWNvcmRlZEJ1ZmZlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGN1cnJlbnRUaW1lXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgY3VycmVudFRpbWUgKCkgOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCArIHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=