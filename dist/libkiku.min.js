!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=r(1);class n{static setup(){n.peerConnStack=new Array(0),n.activeConn=0,void 0!==window.Peer&&(n.peerjs=window.Peer),o.KikuAudioStream.setup(),o.KikuAudioStream.listenForStart(n.onStartRecording)}static connectToServer(e,t,r,o,i){n.myname=e,n.serverAddr=t,n.serverPort=r,n.serverPath=o,void 0===i&&(i=!1);let a={host:n.serverAddr,port:n.serverPort,path:n.serverPath,secure:i};n.peer=new n.peerjs(n.myname,a),n.peer.on("connection",e=>{n.onConnectionCallback(e),e.on("data",t=>{n.onDataCallback(e,t)})})}static connectToDevice(e){let t=n.peer.connect(e);t.on("open",()=>{t.on("data",e=>{n.onDataCallback(t,e)})}),n.peerConnStack.push(t)}static sendEmptyResponse(e){let t=n.findIndexOfDevice(e);if(-1!==t){let e=new a(c.REQUEST_EMPTY_RESPONSE);n.peerConnStack[t].open?(n.ourNetworkTime=n.currentTime(),i.sendData(n.peerConnStack[t],e)):console.warn("Connection to peer was not open to send the data via!")}else console.warn("No peer with that ID was found in the active connection stack!")}static async startRecording(e,t,r){void 0!==r&&(n.flightAllowanceTime=r),n.currentMaster=!0,n.inRecordingFlight=!0,n.activeConn=n.findIndexOfDevice(e);let s=performance.timeOrigin+performance.now()+t,d=n.findIndexOfDevice(e);if(-1!==d){let e=new a(c.REQUEST_RECORD,s);console.log("Sending start record message",e),n.peerConnStack[d].open?i.sendData(n.peerConnStack[d],e):console.warn("Connection to peer was not open to send the data via!")}else console.warn("No peer with that ID was found in the active connection stack!");let u=await o.KikuAudioStream.recordAt(s,n.recordDuration);return n.ourBuffer=u,n.currentMaster=!1,new Promise((e,t)=>{setTimeout(()=>{if(n.inRecordingFlight)t("Recording was still in flight and was not transfered back to this device in time");else{let t={currentDeviceBuffer:n.ourBuffer,requestedDeviceBuffer:new Float32Array(n.theirBuffer),recordingDelay:n.recordingDelayTime,networkDelay:n.networkDelayTime};e(t)}},n.flightAllowanceTime)})}static sendRecordedBuffer(e,t){let r=n.findIndexOfDevice(e);if(-1!==r){let e=new a(c.RESPONSE_RECORD,n.currentTime(),t);n.peerConnStack[r].open?i.sendData(n.peerConnStack[r],e):console.warn("Connection to peer was not open to send the data via!")}else console.warn("No peer with that ID was found in the active connection stack!")}static onStartRecording(){if(!0!==n.currentMaster){console.log("onStartRecording entering send message");let e=new a(c.STARTED_RECORDING);n.peerConnStack[n.activeConn].open?(n.ourRecordingStart=n.currentTime(),console.log("Sending message of start recording",e),i.sendData(n.peerConnStack[n.activeConn],e)):console.warn("Connection to peer was not open to send the data via!")}}static setReturnAllowance(e){n.flightAllowanceTime=e}static deleteUnusedConnections(){for(let e=0;e<n.peerConnStack.length;e++)n.peerConnStack[e].open||n.peerConnStack.splice(e,1)}static findIndexOfDevice(e){for(var t=0;t<n.peerConnStack.length;t++)if(n.peerConnStack[t].peer===e)return t;return-1}static onDataCallback(e,t){switch(console.log("message received:",t),t.type){case c.REQUEST_EMPTY_RESPONSE:let r=new a(c.RESPONSE_EMPTY_RESPONSE);n.ourNetworkTime=n.currentTime(),i.sendData(e,r);break;case c.REQUEST_RECORD:console.log("Asked to start recording..."),o.KikuAudioStream.recordAt(t.timeStamp,n.recordDuration).then(t=>{console.log("Successfully completed recording!"),this.sendRecordedBuffer(e.peer,t)});break;case c.STARTED_RECORDING:n.theirRecordingStart=n.currentTime(),n.updateRecordingDelayTime();break;case c.RESPONSE_EMPTY_RESPONSE:n.theirNetworkTime=n.currentTime(),n.updateNetworkDelayTime();break;case c.RESPONSE_RECORD:n.theirBuffer=t.audioBuffer,n.inRecordingFlight=!1}}static onConnectionCallback(e){console.log("Connection received!",e),n.peerConnStack.push(e)}static onOpenCallback(){console.log("Connection open!")}static currentTime(){return performance.timing.navigationStart+performance.now()}static updateNetworkDelayTime(){n.ourNetworkTime=n.ourNetworkTime||performance.now(),n.theirNetworkTime=n.theirNetworkTime||n.ourNetworkTime,n.networkDelayTime=Math.abs(n.ourNetworkTime-n.theirNetworkTime)/2}static updateRecordingDelayTime(){n.recordingDelayTime=Math.abs(n.ourRecordingStart-n.theirRecordingStart)/2e3}}n.activeConn=0,n.flightAllowanceTime=1e3,n.networkDelayTime=10,n.recordingDelayTime=0,n.ourRecordingStart=n.currentTime(),n.theirRecordingStart=n.ourRecordingStart,n.recordDuration=1e3,n.buffersReady=!1,n.ourBuffer=new Float32Array(1),n.theirBuffer=new Float32Array(1),n.inRecordingFlight=!1,n.currentMaster=!1;class i{static sendData(e,t){let r={type:t.type,timeStamp:t.timeStamp||"",audioBuffer:t.audioBuffer||""};e.open?e.send(r):console.warn("Tried to send message when connection is closed!",r)}}class a{constructor(e,t,r){this.type=e,this.timeStamp=t,this.audioBuffer=r}toObject(){return{messageType:this.type,timeStamp:this.timeStamp||[],audioBuffer:this.audioBuffer||[]}}}var c;!function(e){e.REQUEST_RECORD="requestRecord",e.RESPONSE_RECORD="responseRecord",e.STARTED_RECORDING="startedRecording",e.STOPPED_RECORDING="stoppedRecording",e.REQUEST_EMPTY_RESPONSE="requestEmptyResponse",e.RESPONSE_EMPTY_RESPONSE="responseEmptyResponse"}(c||(c={})),window.Kiku=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{static setup(){o.audioContext=new AudioContext||window.webkitAudioContext(),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(console.log("getUserMedia supported."),navigator.mediaDevices.getUserMedia({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"},optional:[]}}).then(function(e){o.setupStream(e)}).catch(function(e){console.warn("The following getUserMedia error occured: "+e)})):console.warn("getUserMedia not supported on your browser!")}static listenForStart(e){this.startedRecording=e}static listenForEnd(e){this.finishedRecording=e}static float32bufferConcat(e,t){let r=e.length,o=new Float32Array(r+t.length);return o.set(e),o.set(t,r),o}static setupStream(e){o.supported=!0,this.micRecorder=new MediaRecorder(e),o.scriptNode=o.audioContext.createScriptProcessor(1024,1,1),o.mediaStreamSourceNode=o.audioContext.createMediaStreamSource(e),o.scriptNode.onaudioprocess=function(e){o.isRecording?o.activeBuffer=o.float32bufferConcat(o.activeBuffer,e.inputBuffer.getChannelData(0)):!0===o.resetAudioBuffer&&(o.activeBuffer=new Float32Array(1),o.resetAudioBuffer=!1)},o.mediaStreamSourceNode.connect(o.scriptNode),o.scriptNode.connect(o.audioContext.destination)}static async recordAt(e,t){o.clearAudioBuffer();let r=e-o.currentTime();console.log("Starting to record in "+r+" from now ("+r/1e3+")");return await(()=>new Promise(e=>{setTimeout(()=>{o.record(t).then(t=>{e(t)})},r)}))()}static record(e){return new Promise(t=>{o.isRecording=!0,o.startedRecording(),setTimeout(()=>{o.isRecording=!1,o.recordedBuffer=o.activeBuffer,t(o.recordedBuffer)},e)})}static recording(){return o.isRecording}static getLastRecordedBuffer(){return o.recordedBuffer}static currentTime(){return performance.timing.navigationStart+performance.now()}static clearAudioBuffer(){o.resetAudioBuffer=!0}}o.isRecording=!1,o.activeBuffer=new Float32Array(1),o.recordedBuffer=new Float32Array(1),o.startedRecording=(()=>{}),o.finishedRecording=(()=>{}),o.audioContext=new AudioContext,o.supported=!1,o.resetAudioBuffer=!1,t.KikuAudioStream=o}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2tpa3UudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2tpa3VhdWRpb3N0cmVhbS50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImtpa3VhdWRpb3N0cmVhbV8xIiwiS2lrdSIsIltvYmplY3QgT2JqZWN0XSIsInBlZXJDb25uU3RhY2siLCJBcnJheSIsImFjdGl2ZUNvbm4iLCJ1bmRlZmluZWQiLCJ3aW5kb3ciLCJQZWVyIiwicGVlcmpzIiwiS2lrdUF1ZGlvU3RyZWFtIiwic2V0dXAiLCJsaXN0ZW5Gb3JTdGFydCIsIm9uU3RhcnRSZWNvcmRpbmciLCJzZXJ2ZXJBZGRyIiwic2VydmVyUG9ydCIsInNlcnZlclBhdGgiLCJzZWN1cmUiLCJteW5hbWUiLCJzZXJ2ZXJJbmZvIiwiaG9zdCIsInBvcnQiLCJwYXRoIiwicGVlciIsIm9uIiwiY29ubiIsIm9uQ29ubmVjdGlvbkNhbGxiYWNrIiwibWVzc2FnZSIsIm9uRGF0YUNhbGxiYWNrIiwiZGV2aWNlTmFtZSIsInBlZXJDb25uIiwiY29ubmVjdCIsInB1c2giLCJzdGFja0luZGV4IiwiZmluZEluZGV4T2ZEZXZpY2UiLCJNZXNzYWdlRGF0YSIsIk1lc3NhZ2VUeXBlIiwiUkVRVUVTVF9FTVBUWV9SRVNQT05TRSIsIm9wZW4iLCJvdXJOZXR3b3JrVGltZSIsImN1cnJlbnRUaW1lIiwiUGVlckNvbm5lY3Rpb24iLCJzZW5kRGF0YSIsImNvbnNvbGUiLCJ3YXJuIiwiZnJvbU5vdyIsImFsbG93YW5jZVRpbWUiLCJmbGlnaHRBbGxvd2FuY2VUaW1lIiwiY3VycmVudE1hc3RlciIsImluUmVjb3JkaW5nRmxpZ2h0IiwidGltZVN0YW1wIiwicGVyZm9ybWFuY2UiLCJ0aW1lT3JpZ2luIiwibm93IiwiUkVRVUVTVF9SRUNPUkQiLCJsb2ciLCJidWZmZXIiLCJyZWNvcmRBdCIsInJlY29yZER1cmF0aW9uIiwib3VyQnVmZmVyIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJzZXRUaW1lb3V0IiwicmVzdWx0cyIsImN1cnJlbnREZXZpY2VCdWZmZXIiLCJyZXF1ZXN0ZWREZXZpY2VCdWZmZXIiLCJGbG9hdDMyQXJyYXkiLCJ0aGVpckJ1ZmZlciIsInJlY29yZGluZ0RlbGF5IiwicmVjb3JkaW5nRGVsYXlUaW1lIiwibmV0d29ya0RlbGF5IiwibmV0d29ya0RlbGF5VGltZSIsIlJFU1BPTlNFX1JFQ09SRCIsIlNUQVJURURfUkVDT1JESU5HIiwib3VyUmVjb3JkaW5nU3RhcnQiLCJhbGxvd2FuY2UiLCJpbmRleCIsImxlbmd0aCIsInNwbGljZSIsInR5cGUiLCJlbXB0eVJlc3BvbnNlIiwiUkVTUE9OU0VfRU1QVFlfUkVTUE9OU0UiLCJ0aGVuIiwidGhpcyIsInNlbmRSZWNvcmRlZEJ1ZmZlciIsInRoZWlyUmVjb3JkaW5nU3RhcnQiLCJ1cGRhdGVSZWNvcmRpbmdEZWxheVRpbWUiLCJ0aGVpck5ldHdvcmtUaW1lIiwidXBkYXRlTmV0d29ya0RlbGF5VGltZSIsImF1ZGlvQnVmZmVyIiwidGltaW5nIiwibmF2aWdhdGlvblN0YXJ0IiwiTWF0aCIsImFicyIsImJ1ZmZlcnNSZWFkeSIsIm1lc3NhZ2VEYXRhIiwic2VuZCIsIm1lc3NhZ2VUeXBlIiwiYXVkaW9Db250ZXh0IiwiQXVkaW9Db250ZXh0Iiwid2Via2l0QXVkaW9Db250ZXh0IiwibmF2aWdhdG9yIiwibWVkaWFEZXZpY2VzIiwiZ2V0VXNlck1lZGlhIiwiYXVkaW8iLCJtYW5kYXRvcnkiLCJnb29nRWNob0NhbmNlbGxhdGlvbiIsImdvb2dBdXRvR2FpbkNvbnRyb2wiLCJnb29nTm9pc2VTdXBwcmVzc2lvbiIsImdvb2dIaWdocGFzc0ZpbHRlciIsIm9wdGlvbmFsIiwic3RyZWFtIiwic2V0dXBTdHJlYW0iLCJjYXRjaCIsImVyciIsImNhbGxiYWNrIiwic3RhcnRlZFJlY29yZGluZyIsImZpbmlzaGVkUmVjb3JkaW5nIiwiYnVmZmVyMCIsImJ1ZmZlcjEiLCJpdGVtMExlbmd0aCIsInJlc3VsdCIsInNldCIsInN1cHBvcnRlZCIsIm1pY1JlY29yZGVyIiwiTWVkaWFSZWNvcmRlciIsInNjcmlwdE5vZGUiLCJjcmVhdGVTY3JpcHRQcm9jZXNzb3IiLCJtZWRpYVN0cmVhbVNvdXJjZU5vZGUiLCJjcmVhdGVNZWRpYVN0cmVhbVNvdXJjZSIsIm9uYXVkaW9wcm9jZXNzIiwiZXZlbnQiLCJpc1JlY29yZGluZyIsImFjdGl2ZUJ1ZmZlciIsImZsb2F0MzJidWZmZXJDb25jYXQiLCJpbnB1dEJ1ZmZlciIsImdldENoYW5uZWxEYXRhIiwicmVzZXRBdWRpb0J1ZmZlciIsImRlc3RpbmF0aW9uIiwidGltZSIsImR1cmF0aW9uIiwiY2xlYXJBdWRpb0J1ZmZlciIsImV0YV9tcyIsInJlY29yZCIsInJlY29yZGluZyIsIndhaXRVbnRpbCIsInJlY29yZGVkQnVmZmVyIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFFBQUEsSUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFBQyxlQUFBYixFQUFBaUIsT0FBQUMsWUFBQSxDQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQWIsRUFBQSxjQUFpRG1CLE9BQUEsS0FRakRyQixFQUFBc0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEsRUFBQUEsSUFBQUYsRUFBQXJCLEVBQUFxQixJQUNBLEVBQUFFLEVBQUEsT0FBQUYsRUFDQSxLQUFBRSxHQUFBLGlCQUFBRixRQUFBRyxXQUFBLE9BQUFILEVBQ0EsSUFBQUksRUFBQVgsT0FBQVksT0FBQSxNQUdBLEdBRkExQixFQUFBa0IsRUFBQU8sR0FDQVgsT0FBQUMsZUFBQVUsRUFBQSxXQUF5Q1QsWUFBQSxFQUFBSyxVQUN6QyxFQUFBRSxHQUFBLGlCQUFBRixFQUFBLFFBQUFNLEtBQUFOLEVBQUFyQixFQUFBVSxFQUFBZSxFQUFBRSxFQUFBLFNBQUFBLEdBQWdILE9BQUFOLEVBQUFNLElBQXFCQyxLQUFBLEtBQUFELElBQ3JJLE9BQUFGLEdBSUF6QixFQUFBNkIsRUFBQSxTQUFBMUIsR0FDQSxJQUFBUyxFQUFBVCxLQUFBcUIsV0FDQSxXQUEyQixPQUFBckIsRUFBQSxTQUMzQixXQUFpQyxPQUFBQSxHQUVqQyxPQURBSCxFQUFBVSxFQUFBRSxFQUFBLElBQUFBLEdBQ0FBLEdBSUFaLEVBQUFhLEVBQUEsU0FBQWlCLEVBQUFDLEdBQXNELE9BQUFqQixPQUFBa0IsVUFBQUMsZUFBQTFCLEtBQUF1QixFQUFBQyxJQUd0RC9CLEVBQUFrQyxFQUFBLEdBSUFsQyxJQUFBbUMsRUFBQSxtRkNsRkEsTUFBQUMsRUFBQXBDLEVBQUEsR0FLQSxNQUFNcUMsRUFrQ0tDLGVBRUhELEVBQUtFLGNBQWdCLElBQUlDLE1BQU0sR0FDL0JILEVBQUtJLFdBQWEsT0FFU0MsSUFBakJDLE9BQVFDLE9BQ2RQLEVBQUtRLE9BQWVGLE9BQVFDLE1BR2hDUixFQUFBVSxnQkFBZ0JDLFFBQ2hCWCxFQUFBVSxnQkFBZ0JFLGVBQWVYLEVBQUtZLGtCQWFqQ1gsdUJBQXdCM0IsRUFBY3VDLEVBQW9CQyxFQUFvQkMsRUFBbUJDLEdBR3BHaEIsRUFBS2lCLE9BQVMzQyxFQUNkMEIsRUFBS2EsV0FBYUEsRUFDbEJiLEVBQUtjLFdBQWFBLEVBQ2xCZCxFQUFLZSxXQUFhQSxPQUVIVixJQUFYVyxJQUNBQSxHQUFTLEdBSWIsSUFBSUUsRUFBcUIsQ0FDckJDLEtBQU1uQixFQUFLYSxXQUNYTyxLQUFNcEIsRUFBS2MsV0FDWE8sS0FBTXJCLEVBQUtlLFdBQ1hDLE9BQVFBLEdBSVpoQixFQUFLc0IsS0FBTyxJQUFJdEIsRUFBS1EsT0FBT1IsRUFBS2lCLE9BQVFDLEdBR3pDbEIsRUFBS3NCLEtBQUtDLEdBQUcsYUFBZUMsSUFDeEJ4QixFQUFLeUIscUJBQXFCRCxHQUMxQkEsRUFBS0QsR0FBRyxPQUFTRyxJQUNiMUIsRUFBSzJCLGVBQWVILEVBQU1FLE9BWS9CekIsdUJBQXdCMkIsR0FHM0IsSUFBSUMsRUFBVzdCLEVBQUtzQixLQUFLUSxRQUFRRixHQUdqQ0MsRUFBU04sR0FBRyxPQUFRLEtBQ2hCTSxFQUFTTixHQUFHLE9BQVNHLElBQ2pCMUIsRUFBSzJCLGVBQWVFLEVBQVVILE9BS3RDMUIsRUFBS0UsY0FBYzZCLEtBQUtGLEdBUXJCNUIseUJBQTBCMkIsR0FFN0IsSUFBSUksRUFBYWhDLEVBQUtpQyxrQkFBa0JMLEdBRXhDLElBQW9CLElBQWhCSSxFQUFtQixDQUNuQixJQUFJTixFQUFVLElBQUlRLEVBQVlDLEVBQVlDLHdCQUN0Q3BDLEVBQUtFLGNBQWM4QixHQUFZSyxNQUMvQnJDLEVBQUtzQyxlQUFpQnRDLEVBQUt1QyxjQUMzQkMsRUFBZUMsU0FBU3pDLEVBQUtFLGNBQWM4QixHQUFhTixJQUV4RGdCLFFBQVFDLEtBQUssOERBR2pCRCxRQUFRQyxLQUFLLGtFQVlkMUMsNEJBQTZCMkIsRUFBb0JnQixFQUFpQkMsUUFFL0N4QyxJQUFsQndDLElBQ0E3QyxFQUFLOEMsb0JBQXNCRCxHQUcvQjdDLEVBQUsrQyxlQUFnQixFQUVyQi9DLEVBQUtnRCxtQkFBb0IsRUFDekJoRCxFQUFLSSxXQUFhSixFQUFLaUMsa0JBQWtCTCxHQUV6QyxJQUFJcUIsRUFBWUMsWUFBWUMsV0FBYUQsWUFBWUUsTUFBUVIsRUFFekRaLEVBQWFoQyxFQUFLaUMsa0JBQWtCTCxHQUV4QyxJQUFvQixJQUFoQkksRUFBbUIsQ0FDbkIsSUFBSU4sRUFBVSxJQUFJUSxFQUFZQyxFQUFZa0IsZUFBZ0JKLEdBQzFEUCxRQUFRWSxJQUFJLCtCQUFnQzVCLEdBQ3hDMUIsRUFBS0UsY0FBYzhCLEdBQVlLLEtBQy9CRyxFQUFlQyxTQUFTekMsRUFBS0UsY0FBYzhCLEdBQWFOLEdBRXhEZ0IsUUFBUUMsS0FBSyw4REFHakJELFFBQVFDLEtBQUssa0VBR2pCLElBQUlZLFFBQWV4RCxFQUFBVSxnQkFBZ0IrQyxTQUFTUCxFQUFXakQsRUFBS3lELGdCQUk1RCxPQUhBekQsRUFBSzBELFVBQTBCSCxFQUMvQnZELEVBQUsrQyxlQUFnQixFQUVkLElBQUlZLFFBQVMsQ0FBQ0MsRUFBU0MsS0FDMUJDLFdBQVcsS0FDUCxHQUFJOUQsRUFBS2dELGtCQUNMYSxFQUFPLHdGQUNKLENBQ0gsSUFBSUUsRUFBVSxDQUNWQyxvQkFBcUJoRSxFQUFLMEQsVUFDMUJPLHNCQUF1QixJQUFJQyxhQUEwQmxFLEVBQUttRSxhQUMxREMsZUFBZ0JwRSxFQUFLcUUsbUJBQ3JCQyxhQUFjdEUsRUFBS3VFLGtCQUV2QlgsRUFBU0csS0FFZC9ELEVBQUs4Qyx1QkFXVDdDLDBCQUEyQjJCLEVBQW9CMkIsR0FDbEQsSUFBSXZCLEVBQWFoQyxFQUFLaUMsa0JBQWtCTCxHQUV4QyxJQUFvQixJQUFoQkksRUFBbUIsQ0FDbkIsSUFBSU4sRUFBVSxJQUFJUSxFQUFZQyxFQUFZcUMsZ0JBQWlCeEUsRUFBS3VDLGNBQWVnQixHQUMzRXZELEVBQUtFLGNBQWM4QixHQUFZSyxLQUMvQkcsRUFBZUMsU0FBU3pDLEVBQUtFLGNBQWM4QixHQUFhTixHQUV4RGdCLFFBQVFDLEtBQUssOERBR2pCRCxRQUFRQyxLQUFLLGtFQVNiMUMsMEJBQ0osSUFBMkIsSUFBdkJELEVBQUsrQyxjQUF3QixDQUM3QkwsUUFBUVksSUFBSSwwQ0FDWixJQUFJNUIsRUFBVSxJQUFJUSxFQUFZQyxFQUFZc0MsbUJBQ3RDekUsRUFBS0UsY0FBY0YsRUFBS0ksWUFBWWlDLE1BQ3BDckMsRUFBSzBFLGtCQUFvQjFFLEVBQUt1QyxjQUM5QkcsUUFBUVksSUFBSSxxQ0FBc0M1QixHQUNsRGMsRUFBZUMsU0FBU3pDLEVBQUtFLGNBQWNGLEVBQUtJLFlBQWFzQixJQUU3RGdCLFFBQVFDLEtBQUssMERBV2xCMUMsMEJBQTJCMEUsR0FDOUIzRSxFQUFLOEMsb0JBQXNCNkIsRUFReEIxRSxpQ0FDSCxJQUFLLElBQUkyRSxFQUFRLEVBQUdBLEVBQVE1RSxFQUFLRSxjQUFjMkUsT0FBUUQsSUFDOUM1RSxFQUFLRSxjQUFjMEUsR0FBT3ZDLE1BQzNCckMsRUFBS0UsY0FBYzRFLE9BQU9GLEVBQU8sR0FXckMzRSx5QkFBMEIyQixHQUU5QixJQUFLLElBQUlnRCxFQUFRLEVBQUdBLEVBQVE1RSxFQUFLRSxjQUFjMkUsT0FBUUQsSUFDbkQsR0FBSTVFLEVBQUtFLGNBQWMwRSxHQUFPdEQsT0FBU00sRUFDbkMsT0FBT2dELEVBR2YsT0FBUSxFQVVKM0Usc0JBQXVCdUIsRUFBV0UsR0FJdEMsT0FGQWdCLFFBQVFZLElBQUksb0JBQXFCNUIsR0FFekJBLEVBQVFxRCxNQUVaLEtBQU01QyxFQUFrQyx1QkFDcEMsSUFBSTZDLEVBQWdCLElBQUk5QyxFQUFZQyxFQUFZOEMseUJBQ2hEakYsRUFBS3NDLGVBQWlCdEMsRUFBS3VDLGNBQzNCQyxFQUFlQyxTQUFTakIsRUFBTXdELEdBQzlCLE1BRUosS0FBTTdDLEVBQTBCLGVBQzVCTyxRQUFRWSxJQUFJLCtCQUNadkQsRUFBQVUsZ0JBQWdCK0MsU0FBUzlCLEVBQVF1QixVQUFXakQsRUFBS3lELGdCQUFnQnlCLEtBQU0zQixJQUNuRWIsUUFBUVksSUFBSSxxQ0FDWjZCLEtBQUtDLG1CQUFtQjVELEVBQUtGLEtBQU1pQyxLQUV2QyxNQUVKLEtBQU1wQixFQUE2QixrQkFDL0JuQyxFQUFLcUYsb0JBQXNCckYsRUFBS3VDLGNBQ2hDdkMsRUFBS3NGLDJCQUNMLE1BRUosS0FBTW5ELEVBQW1DLHdCQUNyQ25DLEVBQUt1RixpQkFBbUJ2RixFQUFLdUMsY0FDN0J2QyxFQUFLd0YseUJBQ0wsTUFFSixLQUFNckQsRUFBMkIsZ0JBQzdCbkMsRUFBS21FLFlBQWN6QyxFQUFRK0QsWUFDM0J6RixFQUFLZ0QsbUJBQW9CLEdBWTdCL0MsNEJBQTZCdUIsR0FDakNrQixRQUFRWSxJQUFJLHVCQUF3QjlCLEdBQ3BDeEIsRUFBS0UsY0FBYzZCLEtBQUtQLEdBUXBCdkIsd0JBQ0p5QyxRQUFRWSxJQUFJLG9CQVFSckQscUJBQ0osT0FBT2lELFlBQVl3QyxPQUFPQyxnQkFBa0J6QyxZQUFZRSxNQVFwRG5ELGdDQUNKRCxFQUFLc0MsZUFBaUJ0QyxFQUFLc0MsZ0JBQWtCWSxZQUFZRSxNQUN6RHBELEVBQUt1RixpQkFBbUJ2RixFQUFLdUYsa0JBQW9CdkYsRUFBS3NDLGVBQ3REdEMsRUFBS3VFLGlCQUFtQnFCLEtBQUtDLElBQUk3RixFQUFLc0MsZUFBaUJ0QyxFQUFLdUYsa0JBQWtCLEVBUTFFdEYsa0NBQ0pELEVBQUtxRSxtQkFBcUJ1QixLQUFLQyxJQUFJN0YsRUFBSzBFLGtCQUFvQjFFLEVBQUtxRixxQkFBcUIsS0FoV25GckYsRUFBQUksV0FBcUIsRUFDckJKLEVBQUE4QyxvQkFBOEIsSUFFOUI5QyxFQUFBdUUsaUJBQTJCLEdBSTNCdkUsRUFBQXFFLG1CQUE2QixFQUM3QnJFLEVBQUEwRSxrQkFBNEIxRSxFQUFLdUMsY0FDakN2QyxFQUFBcUYsb0JBQThCckYsRUFBSzBFLGtCQUVuQzFFLEVBQUF5RCxlQUF5QixJQUN6QnpELEVBQUE4RixjQUF3QixFQUV4QjlGLEVBQUEwRCxVQUEyQixJQUFJUSxhQUFhLEdBQzVDbEUsRUFBQW1FLFlBQTZCLElBQUlELGFBQWEsR0FDOUNsRSxFQUFBZ0QsbUJBQTZCLEVBRTdCaEQsRUFBQStDLGVBQXlCLEVBc1ZwQyxNQUFNUCxFQVNLdkMsZ0JBQWlCdUIsRUFBV3VFLEdBRS9CLElBQUlyRSxFQUFrQixDQUNsQnFELEtBQU1nQixFQUFZaEIsS0FDbEI5QixVQUFXOEMsRUFBWTlDLFdBQWEsR0FDcEN3QyxZQUFhTSxFQUFZTixhQUFlLElBR3hDakUsRUFBS2EsS0FDTGIsRUFBS3dFLEtBQUt0RSxHQUVWZ0IsUUFBUUMsS0FBSyxtREFBb0RqQixJQVE3RSxNQUFNUSxFQVlGakMsWUFBYWdHLEVBQXFCaEQsRUFBb0J3QyxHQUNsRE4sS0FBS0osS0FBT2tCLEVBQ1pkLEtBQUtsQyxVQUFZQSxFQUNqQmtDLEtBQUtNLFlBQWNBLEVBT2hCeEYsV0FDSCxNQUFPLENBQ0hnRyxZQUFhZCxLQUFLSixLQUNsQjlCLFVBQVdrQyxLQUFLbEMsV0FBYSxHQUM3QndDLFlBQWFOLEtBQUtNLGFBQWUsS0FTN0MsSUFBS3RELEdBQUwsU0FBS0EsR0FFREEsRUFBQSwrQkFDQUEsRUFBQSxpQ0FFQUEsRUFBQSxxQ0FDQUEsRUFBQSxxQ0FFQUEsRUFBQSw4Q0FDQUEsRUFBQSxnREFUSixDQUFLQSxNQUFXLEtBY1Y3QixPQUFRTixLQUFPQSxpRkM5YnJCLE1BQWFTLEVBd0JGUixlQUVIUSxFQUFnQnlGLGFBQWUsSUFBSUMsY0FBd0I3RixPQUFROEYscUJBRS9EQyxVQUFVQyxjQUFnQkQsVUFBVUMsYUFBYUMsY0FFakQ3RCxRQUFRWSxJQUFJLDJCQUNaK0MsVUFBVUMsYUFBYUMsYUFDZixDQUNKQyxNQUFTLENBQ0xDLFVBQWEsQ0FDVEMscUJBQXdCLFFBQ3hCQyxvQkFBdUIsUUFDdkJDLHFCQUF3QixRQUN4QkMsbUJBQXNCLFNBRTFCQyxTQUFZLE1BS2hCNUIsS0FBSyxTQUFVNkIsR0FDWHRHLEVBQWdCdUcsWUFBWUQsS0FJaENFLE1BQU0sU0FBU0MsR0FDYnhFLFFBQVFDLEtBQUssNkNBQStDdUUsTUFNbEV4RSxRQUFRQyxLQUFLLCtDQVlkMUMsc0JBQXVCa0gsR0FDMUJoQyxLQUFLaUMsaUJBQW1CRCxFQVNyQmxILG9CQUFxQmtILEdBQ3hCaEMsS0FBS2tDLGtCQUFvQkYsRUFVckJsSCwyQkFBNEJxSCxFQUF1QkMsR0FFdkQsSUFBSUMsRUFBY0YsRUFBUXpDLE9BQ3RCNEMsRUFBUyxJQUFJdkQsYUFBYXNELEVBQWNELEVBQVExQyxRQUtwRCxPQUhBNEMsRUFBT0MsSUFBSUosR0FDWEcsRUFBT0MsSUFBSUgsRUFBU0MsR0FFYkMsRUFVSHhILG1CQUFvQjhHLEdBR3hCdEcsRUFBZ0JrSCxXQUFZLEVBQzVCeEMsS0FBS3lDLFlBQWMsSUFBSUMsY0FBY2QsR0FHckN0RyxFQUFnQnFILFdBQWFySCxFQUFnQnlGLGFBQWE2QixzQkFBc0IsS0FBTSxFQUFHLEdBQ3pGdEgsRUFBZ0J1SCxzQkFBd0J2SCxFQUFnQnlGLGFBQWErQix3QkFBd0JsQixHQUc3RnRHLEVBQWdCcUgsV0FBV0ksZUFBaUIsU0FBU0MsR0FHOUMxSCxFQUFnQjJILFlBQ2YzSCxFQUFnQjRILGFBQWU1SCxFQUFnQjZILG9CQUFvQjdILEVBQWdCNEgsYUFBY0YsRUFBTUksWUFBWUMsZUFBZSxLQUV6RixJQUFyQy9ILEVBQWdCZ0ksbUJBRWhCaEksRUFBZ0I0SCxhQUFlLElBQUluRSxhQUFhLEdBQ2hEekQsRUFBZ0JnSSxrQkFBbUIsSUFPL0NoSSxFQUFnQnVILHNCQUFzQmxHLFFBQVFyQixFQUFnQnFILFlBQzlEckgsRUFBZ0JxSCxXQUFXaEcsUUFBUXJCLEVBQWdCeUYsYUFBYXdDLGFBVzdEekksc0JBQXVCMEksRUFBY0MsR0FHeENuSSxFQUFnQm9JLG1CQUdoQixJQUFJQyxFQUFTSCxFQUFPbEksRUFBZ0I4QixjQUNwQ0csUUFBUVksSUFBSSx5QkFBMkJ3RixFQUFTLGNBQWdCQSxFQUFPLElBQU8sS0FpQjlFLFlBZGdCLEtBQ0wsSUFBSW5GLFFBQVVDLElBQ2pCRSxXQUFXLEtBQ1ByRCxFQUFnQnNJLE9BQU9ILEdBQVUxRCxLQUFNOEQsSUFDbkNwRixFQUFRb0YsTUFFYkYsS0FLV0csR0FhbkJoSixjQUFlMkksR0FFbEIsT0FBTyxJQUFJakYsUUFBVUMsSUFHakJuRCxFQUFnQjJILGFBQWMsRUFHOUIzSCxFQUFnQjJHLG1CQUdoQnRELFdBQVcsS0FDUHJELEVBQWdCMkgsYUFBYyxFQUM5QjNILEVBQWdCeUksZUFBaUJ6SSxFQUFnQjRILGFBQ2pEekUsRUFBUW5ELEVBQWdCeUksaUJBQ3pCTixLQVVKM0ksbUJBQ0gsT0FBT1EsRUFBZ0IySCxZQVFwQm5JLCtCQUNILE9BQU9RLEVBQWdCeUksZUFRbkJqSixxQkFDSixPQUFPaUQsWUFBWXdDLE9BQU9DLGdCQUFrQnpDLFlBQVlFLE1BR3JEbkQsMEJBQ0hRLEVBQWdCZ0ksa0JBQW1CLEdBbk9oQ2hJLEVBQUEySCxhQUF1QixFQUN2QjNILEVBQUE0SCxhQUE2QixJQUFJbkUsYUFBYSxHQUM5Q3pELEVBQUF5SSxlQUErQixJQUFJaEYsYUFBYSxHQUV6Q3pELEVBQUEyRyxpQkFBNkIsU0FDN0IzRyxFQUFBNEcsa0JBQThCLFNBRXJDNUcsRUFBQXlGLGFBQTZCLElBQUlDLGFBTWpDMUYsRUFBQWtILFdBQXFCLEVBRWJsSCxFQUFBZ0ksa0JBQTRCLEVBakIvQzVLLEVBQUE0QyIsImZpbGUiOiJsaWJraWt1Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCB7IEtpa3VBdWRpb1N0cmVhbSB9IGZyb20gJy4va2lrdWF1ZGlvc3RyZWFtJztcblxuLyoqXG4gKiBAY2xhc3MgS2lrdVxuICovXG5jbGFzcyBLaWt1IHtcblxuICAgIHN0YXRpYyBteW5hbWU/OiBzdHJpbmc7XG4gICAgc3RhdGljIHNlcnZlckFkZHI/OiBzdHJpbmc7XG4gICAgc3RhdGljIHNlcnZlclBvcnQ/OiBzdHJpbmc7XG4gICAgc3RhdGljIHNlcnZlclBhdGg/OiBzdHJpbmc7XG4gICAgc3RhdGljIHBlZXJqcz86IGFueTtcbiAgICBzdGF0aWMgcGVlcj86IGFueTtcbiAgICBzdGF0aWMgcGVlckNvbm5TdGFjazogYW55W107XG4gICAgc3RhdGljIGFjdGl2ZUNvbm46IG51bWJlciA9IDA7XG4gICAgc3RhdGljIGZsaWdodEFsbG93YW5jZVRpbWU6IG51bWJlciA9IDEwMDA7XG5cbiAgICBzdGF0aWMgbmV0d29ya0RlbGF5VGltZTogbnVtYmVyID0gMTA7XG4gICAgc3RhdGljIG91ck5ldHdvcmtUaW1lPzogbnVtYmVyOyBcbiAgICBzdGF0aWMgdGhlaXJOZXR3b3JrVGltZT86IG51bWJlcjsgXG5cbiAgICBzdGF0aWMgcmVjb3JkaW5nRGVsYXlUaW1lOiBudW1iZXIgPSAwO1xuICAgIHN0YXRpYyBvdXJSZWNvcmRpbmdTdGFydDogbnVtYmVyID0gS2lrdS5jdXJyZW50VGltZSgpO1xuICAgIHN0YXRpYyB0aGVpclJlY29yZGluZ1N0YXJ0OiBudW1iZXIgPSBLaWt1Lm91clJlY29yZGluZ1N0YXJ0O1xuXG4gICAgc3RhdGljIHJlY29yZER1cmF0aW9uOiBudW1iZXIgPSAxMDAwO1xuICAgIHN0YXRpYyBidWZmZXJzUmVhZHk6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIHN0YXRpYyBvdXJCdWZmZXI/OiBGbG9hdDMyQXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KDEpO1xuICAgIHN0YXRpYyB0aGVpckJ1ZmZlcj86IEZsb2F0MzJBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7XG4gICAgc3RhdGljIGluUmVjb3JkaW5nRmxpZ2h0OiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBzdGF0aWMgY3VycmVudE1hc3RlcjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZXR1cFxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBzZXR1cCAoKSB7XG5cbiAgICAgICAgS2lrdS5wZWVyQ29ublN0YWNrID0gbmV3IEFycmF5KDApO1xuICAgICAgICBLaWt1LmFjdGl2ZUNvbm4gPSAwO1xuXG4gICAgICAgIGlmICgoPGFueT53aW5kb3cpLlBlZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgS2lrdS5wZWVyanMgPSAoPGFueT53aW5kb3cpLlBlZXI7XG4gICAgICAgIH1cblxuICAgICAgICBLaWt1QXVkaW9TdHJlYW0uc2V0dXAoKTtcbiAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLmxpc3RlbkZvclN0YXJ0KEtpa3Uub25TdGFydFJlY29yZGluZyk7XG4gICAgICAgIFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgY29ubmVjdFRvU2VydmVyXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gbmFtZSA6IE5hbWUgb2YgdGhlIHBlZXIgb24gdGhpcyBkZXZpY2VcbiAgICAgKiBAcGFyYW0gc2VydmVyQWRkciA6IFNlcnZlciBJUCBsb2NhdGlvblxuICAgICAqIEBwYXJhbSBzZXJ2ZXJQb3J0IDogU2VydmVyIHBvcnRcbiAgICAgKiBAcGFyYW0gc2VydmVyUGF0aCA6IFBlZXJqcyBzZXJ2ZXIgcGF0aFxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgY29ubmVjdFRvU2VydmVyIChuYW1lOiBzdHJpbmcsIHNlcnZlckFkZHI6IHN0cmluZywgc2VydmVyUG9ydDogc3RyaW5nLCBzZXJ2ZXJQYXRoOnN0cmluZywgc2VjdXJlPzogYm9vbGVhbikge1xuXG4gICAgICAgIC8vIFNldHVwIHByb3BlcnRpZXNcbiAgICAgICAgS2lrdS5teW5hbWUgPSBuYW1lO1xuICAgICAgICBLaWt1LnNlcnZlckFkZHIgPSBzZXJ2ZXJBZGRyO1xuICAgICAgICBLaWt1LnNlcnZlclBvcnQgPSBzZXJ2ZXJQb3J0O1xuICAgICAgICBLaWt1LnNlcnZlclBhdGggPSBzZXJ2ZXJQYXRoO1xuXG4gICAgICAgIGlmIChzZWN1cmUgPT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICBzZWN1cmUgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZvcm1hdCBmb3IgcGVlcmpzXG4gICAgICAgIGxldCBzZXJ2ZXJJbmZvOiBPYmplY3QgPSB7XG4gICAgICAgICAgICBob3N0OiBLaWt1LnNlcnZlckFkZHIsXG4gICAgICAgICAgICBwb3J0OiBLaWt1LnNlcnZlclBvcnQsXG4gICAgICAgICAgICBwYXRoOiBLaWt1LnNlcnZlclBhdGgsXG4gICAgICAgICAgICBzZWN1cmU6IHNlY3VyZVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIENvbm5lY3QgdG8gc2VydmVyXG4gICAgICAgIEtpa3UucGVlciA9IG5ldyBLaWt1LnBlZXJqcyhLaWt1Lm15bmFtZSwgc2VydmVySW5mbyk7IFxuXG4gICAgICAgIC8vIEFzc2lnbiBjYWxsYmFja3MgdG8gcGVlciBvYmplY3RcbiAgICAgICAgS2lrdS5wZWVyLm9uKCdjb25uZWN0aW9uJywgKGNvbm46IGFueSkgPT4ge1xuICAgICAgICAgICAgS2lrdS5vbkNvbm5lY3Rpb25DYWxsYmFjayhjb25uKTtcbiAgICAgICAgICAgIGNvbm4ub24oJ2RhdGEnLCAobWVzc2FnZTogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgS2lrdS5vbkRhdGFDYWxsYmFjayhjb25uLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGNvbm5lY3RUb0RldmljZVxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIGRldmljZU5hbWUgXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBjb25uZWN0VG9EZXZpY2UgKGRldmljZU5hbWU6IHN0cmluZykge1xuXG4gICAgICAgIC8vIENvbm5lY3QgdG8gcGVlclxuICAgICAgICBsZXQgcGVlckNvbm4gPSBLaWt1LnBlZXIuY29ubmVjdChkZXZpY2VOYW1lKTtcblxuICAgICAgICAvLyBTZXR1cCBjYWxsYmFja3MgYmVmb3JlIGFkZGluZyB0byB0aGUgc3RhY2tcbiAgICAgICAgcGVlckNvbm4ub24oJ29wZW4nLCAoKSA9PiB7XG4gICAgICAgICAgICBwZWVyQ29ubi5vbignZGF0YScsIChtZXNzYWdlOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICBLaWt1Lm9uRGF0YUNhbGxiYWNrKHBlZXJDb25uLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQWRkIG9udG8gdGhlIGNvbm5lY3Rpb24gc3RhY2tcbiAgICAgICAgS2lrdS5wZWVyQ29ublN0YWNrLnB1c2gocGVlckNvbm4pO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZW5kRW1wdHlSZXNwb25zZVxuICAgICAqIEBwYXJhbSBkZXZpY2VOYW1lIDogTmFtZSBvZiBkZXZpY2UgdG8gc2VuZCBtZXNzYWdlIHRvXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBzZW5kRW1wdHlSZXNwb25zZSAoZGV2aWNlTmFtZTogc3RyaW5nKSB7XG5cbiAgICAgICAgbGV0IHN0YWNrSW5kZXggPSBLaWt1LmZpbmRJbmRleE9mRGV2aWNlKGRldmljZU5hbWUpO1xuXG4gICAgICAgIGlmIChzdGFja0luZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBuZXcgTWVzc2FnZURhdGEoTWVzc2FnZVR5cGUuUkVRVUVTVF9FTVBUWV9SRVNQT05TRSk7XG4gICAgICAgICAgICBpZiAoS2lrdS5wZWVyQ29ublN0YWNrW3N0YWNrSW5kZXhdLm9wZW4pe1xuICAgICAgICAgICAgICAgIEtpa3Uub3VyTmV0d29ya1RpbWUgPSBLaWt1LmN1cnJlbnRUaW1lKCk7XG4gICAgICAgICAgICAgICAgUGVlckNvbm5lY3Rpb24uc2VuZERhdGEoS2lrdS5wZWVyQ29ublN0YWNrW3N0YWNrSW5kZXhdLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDb25uZWN0aW9uIHRvIHBlZXIgd2FzIG5vdCBvcGVuIHRvIHNlbmQgdGhlIGRhdGEgdmlhIScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdObyBwZWVyIHdpdGggdGhhdCBJRCB3YXMgZm91bmQgaW4gdGhlIGFjdGl2ZSBjb25uZWN0aW9uIHN0YWNrIScpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHN0YXJ0UmVjb3JkaW5nXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gZGV2aWNlTmFtZSA6IERldmljZSB0byByZXF1ZXN0IHN5bmNocm9uaXplZCByZWNvcmRpbmdcbiAgICAgKiBAcGFyYW0gZnJvbU5vdyA6IE51bWJlciBvZiBtaWxpc2Vjb25kcyB0byBzdGFydCBmcm9tIG5vd1xuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgc3RhcnRSZWNvcmRpbmcgKGRldmljZU5hbWU6IHN0cmluZywgZnJvbU5vdzogbnVtYmVyLCBhbGxvd2FuY2VUaW1lPzogbnVtYmVyKSB7XG5cbiAgICAgICAgaWYgKGFsbG93YW5jZVRpbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgS2lrdS5mbGlnaHRBbGxvd2FuY2VUaW1lID0gYWxsb3dhbmNlVGltZTtcbiAgICAgICAgfVxuXG4gICAgICAgIEtpa3UuY3VycmVudE1hc3RlciA9IHRydWU7XG5cbiAgICAgICAgS2lrdS5pblJlY29yZGluZ0ZsaWdodCA9IHRydWU7XG4gICAgICAgIEtpa3UuYWN0aXZlQ29ubiA9IEtpa3UuZmluZEluZGV4T2ZEZXZpY2UoZGV2aWNlTmFtZSk7XG5cbiAgICAgICAgbGV0IHRpbWVTdGFtcCA9IHBlcmZvcm1hbmNlLnRpbWVPcmlnaW4gKyBwZXJmb3JtYW5jZS5ub3coKSArIGZyb21Ob3c7XG5cbiAgICAgICAgbGV0IHN0YWNrSW5kZXggPSBLaWt1LmZpbmRJbmRleE9mRGV2aWNlKGRldmljZU5hbWUpO1xuXG4gICAgICAgIGlmIChzdGFja0luZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBuZXcgTWVzc2FnZURhdGEoTWVzc2FnZVR5cGUuUkVRVUVTVF9SRUNPUkQsIHRpbWVTdGFtcCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU2VuZGluZyBzdGFydCByZWNvcmQgbWVzc2FnZScsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgaWYgKEtpa3UucGVlckNvbm5TdGFja1tzdGFja0luZGV4XS5vcGVuKVxuICAgICAgICAgICAgICAgIFBlZXJDb25uZWN0aW9uLnNlbmREYXRhKEtpa3UucGVlckNvbm5TdGFja1tzdGFja0luZGV4XSwgbWVzc2FnZSk7XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0Nvbm5lY3Rpb24gdG8gcGVlciB3YXMgbm90IG9wZW4gdG8gc2VuZCB0aGUgZGF0YSB2aWEhJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ05vIHBlZXIgd2l0aCB0aGF0IElEIHdhcyBmb3VuZCBpbiB0aGUgYWN0aXZlIGNvbm5lY3Rpb24gc3RhY2shJyk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgYnVmZmVyID0gYXdhaXQgS2lrdUF1ZGlvU3RyZWFtLnJlY29yZEF0KHRpbWVTdGFtcCwgS2lrdS5yZWNvcmREdXJhdGlvbik7XG4gICAgICAgIEtpa3Uub3VyQnVmZmVyID0gPEZsb2F0MzJBcnJheT5idWZmZXI7XG4gICAgICAgIEtpa3UuY3VycmVudE1hc3RlciA9IGZhbHNlO1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSAoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+IHtcbiAgICAgICAgICAgICAgICBpZiAoS2lrdS5pblJlY29yZGluZ0ZsaWdodCkge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoJ1JlY29yZGluZyB3YXMgc3RpbGwgaW4gZmxpZ2h0IGFuZCB3YXMgbm90IHRyYW5zZmVyZWQgYmFjayB0byB0aGlzIGRldmljZSBpbiB0aW1lJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3VsdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RGV2aWNlQnVmZmVyOiBLaWt1Lm91ckJ1ZmZlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RlZERldmljZUJ1ZmZlcjogbmV3IEZsb2F0MzJBcnJheSg8QXJyYXlCdWZmZXI+S2lrdS50aGVpckJ1ZmZlciksXG4gICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRpbmdEZWxheTogS2lrdS5yZWNvcmRpbmdEZWxheVRpbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXR3b3JrRGVsYXk6IEtpa3UubmV0d29ya0RlbGF5VGltZVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlIChyZXN1bHRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBLaWt1LmZsaWdodEFsbG93YW5jZVRpbWUpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHNlbmRSZWNvcmRlZEJ1ZmZlclxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIGRldmljZU5hbWUgOiBEZXZpY2UgdG8gc2VuZCByZWNvcmRlZCBidWZmZXIgdG9cbiAgICAgKiBAcGFyYW0gYnVmZmVyIDogQXVkaW8gYnVmZmVyIHRvIHNlbmRcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHNlbmRSZWNvcmRlZEJ1ZmZlciAoZGV2aWNlTmFtZTogc3RyaW5nLCBidWZmZXI6IEZsb2F0MzJBcnJheSkge1xuICAgICAgICBsZXQgc3RhY2tJbmRleCA9IEtpa3UuZmluZEluZGV4T2ZEZXZpY2UoZGV2aWNlTmFtZSk7XG5cbiAgICAgICAgaWYgKHN0YWNrSW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICBsZXQgbWVzc2FnZSA9IG5ldyBNZXNzYWdlRGF0YShNZXNzYWdlVHlwZS5SRVNQT05TRV9SRUNPUkQsIEtpa3UuY3VycmVudFRpbWUoKSwgYnVmZmVyKTtcbiAgICAgICAgICAgIGlmIChLaWt1LnBlZXJDb25uU3RhY2tbc3RhY2tJbmRleF0ub3BlbilcbiAgICAgICAgICAgICAgICBQZWVyQ29ubmVjdGlvbi5zZW5kRGF0YShLaWt1LnBlZXJDb25uU3RhY2tbc3RhY2tJbmRleF0sIG1lc3NhZ2UpO1xuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdDb25uZWN0aW9uIHRvIHBlZXIgd2FzIG5vdCBvcGVuIHRvIHNlbmQgdGhlIGRhdGEgdmlhIScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdObyBwZWVyIHdpdGggdGhhdCBJRCB3YXMgZm91bmQgaW4gdGhlIGFjdGl2ZSBjb25uZWN0aW9uIHN0YWNrIScpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBvblN0YXJ0UmVjb3JkaW5nXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgb25TdGFydFJlY29yZGluZyAoKSB7XG4gICAgICAgIGlmIChLaWt1LmN1cnJlbnRNYXN0ZXIgIT09IHRydWUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvblN0YXJ0UmVjb3JkaW5nIGVudGVyaW5nIHNlbmQgbWVzc2FnZScpO1xuICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBuZXcgTWVzc2FnZURhdGEoTWVzc2FnZVR5cGUuU1RBUlRFRF9SRUNPUkRJTkcpO1xuICAgICAgICAgICAgaWYgKEtpa3UucGVlckNvbm5TdGFja1tLaWt1LmFjdGl2ZUNvbm5dLm9wZW4pe1xuICAgICAgICAgICAgICAgIEtpa3Uub3VyUmVjb3JkaW5nU3RhcnQgPSBLaWt1LmN1cnJlbnRUaW1lKCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1NlbmRpbmcgbWVzc2FnZSBvZiBzdGFydCByZWNvcmRpbmcnLCBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICBQZWVyQ29ubmVjdGlvbi5zZW5kRGF0YShLaWt1LnBlZXJDb25uU3RhY2tbS2lrdS5hY3RpdmVDb25uXSwgbWVzc2FnZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignQ29ubmVjdGlvbiB0byBwZWVyIHdhcyBub3Qgb3BlbiB0byBzZW5kIHRoZSBkYXRhIHZpYSEnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgc2V0UmV0dXJuQWxsb3dhbmNlXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gYWxsb3dhbmNlIDogUmV0dXJuIHRpbWUgYWxsb3dhbmNlIGJlZm9yZSB0aW1lb3V0IHdoZW4gd2FpdGluZyBmb3Igb3RoZXIgZGV2aWNlIGJ1ZmZlclxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgc2V0UmV0dXJuQWxsb3dhbmNlIChhbGxvd2FuY2U6IG51bWJlcikge1xuICAgICAgICBLaWt1LmZsaWdodEFsbG93YW5jZVRpbWUgPSBhbGxvd2FuY2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBkZWxldGVVbnVzZWRDb25uZWN0aW9uc1xuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBkZWxldGVVbnVzZWRDb25uZWN0aW9ucyAoKSB7XG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBLaWt1LnBlZXJDb25uU3RhY2subGVuZ3RoOyBpbmRleCsrKXtcbiAgICAgICAgICAgIGlmICghS2lrdS5wZWVyQ29ublN0YWNrW2luZGV4XS5vcGVuKXtcbiAgICAgICAgICAgICAgICBLaWt1LnBlZXJDb25uU3RhY2suc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZmluZEluZGV4T2ZEZXZpY2VcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0gZGV2aWNlTmFtZSA6IERldmljZSBpZCB0byBzZWFyY2ggaW4gdGhlIGNvbm5lY3Rpb24gc3RhY2tcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBmaW5kSW5kZXhPZkRldmljZSAoZGV2aWNlTmFtZTogc3RyaW5nKSA6IG51bWJlciB7XG5cbiAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IEtpa3UucGVlckNvbm5TdGFjay5sZW5ndGg7IGluZGV4Kyspe1xuICAgICAgICAgICAgaWYgKEtpa3UucGVlckNvbm5TdGFja1tpbmRleF0ucGVlciA9PT0gZGV2aWNlTmFtZSl7ICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIG9uRGF0YUNhbGxiYWNrXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIGNvbm4gOiBQZWVyanMgY29ubmVjdGlvbiB0byBwYXNzIGluXG4gICAgICogQHBhcmFtIG1lc3NhZ2UgOiBNZXNzYWdlIHJlY2VpdmVkIG9uIHRoZSBjb25uZWN0aW9uXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgb25EYXRhQ2FsbGJhY2sgKGNvbm46IGFueSwgbWVzc2FnZTogYW55KSB7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ21lc3NhZ2UgcmVjZWl2ZWQ6JywgbWVzc2FnZSk7XG5cbiAgICAgICAgc3dpdGNoIChtZXNzYWdlLnR5cGUpIHtcblxuICAgICAgICAgICAgY2FzZSAoTWVzc2FnZVR5cGUuUkVRVUVTVF9FTVBUWV9SRVNQT05TRSk6XG4gICAgICAgICAgICAgICAgbGV0IGVtcHR5UmVzcG9uc2UgPSBuZXcgTWVzc2FnZURhdGEoTWVzc2FnZVR5cGUuUkVTUE9OU0VfRU1QVFlfUkVTUE9OU0UpO1xuICAgICAgICAgICAgICAgIEtpa3Uub3VyTmV0d29ya1RpbWUgPSBLaWt1LmN1cnJlbnRUaW1lKCk7XG4gICAgICAgICAgICAgICAgUGVlckNvbm5lY3Rpb24uc2VuZERhdGEoY29ubiwgZW1wdHlSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgKE1lc3NhZ2VUeXBlLlJFUVVFU1RfUkVDT1JEKTpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQXNrZWQgdG8gc3RhcnQgcmVjb3JkaW5nLi4uJylcbiAgICAgICAgICAgICAgICBLaWt1QXVkaW9TdHJlYW0ucmVjb3JkQXQobWVzc2FnZS50aW1lU3RhbXAsIEtpa3UucmVjb3JkRHVyYXRpb24pLnRoZW4oKGJ1ZmZlcjogYW55KT0+e1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU3VjY2Vzc2Z1bGx5IGNvbXBsZXRlZCByZWNvcmRpbmchJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZFJlY29yZGVkQnVmZmVyKGNvbm4ucGVlciwgYnVmZmVyKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIChNZXNzYWdlVHlwZS5TVEFSVEVEX1JFQ09SRElORyk6XG4gICAgICAgICAgICAgICAgS2lrdS50aGVpclJlY29yZGluZ1N0YXJ0ID0gS2lrdS5jdXJyZW50VGltZSgpO1xuICAgICAgICAgICAgICAgIEtpa3UudXBkYXRlUmVjb3JkaW5nRGVsYXlUaW1lKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgKE1lc3NhZ2VUeXBlLlJFU1BPTlNFX0VNUFRZX1JFU1BPTlNFKTpcbiAgICAgICAgICAgICAgICBLaWt1LnRoZWlyTmV0d29ya1RpbWUgPSBLaWt1LmN1cnJlbnRUaW1lKCk7XG4gICAgICAgICAgICAgICAgS2lrdS51cGRhdGVOZXR3b3JrRGVsYXlUaW1lKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgKE1lc3NhZ2VUeXBlLlJFU1BPTlNFX1JFQ09SRCk6XG4gICAgICAgICAgICAgICAgS2lrdS50aGVpckJ1ZmZlciA9IG1lc3NhZ2UuYXVkaW9CdWZmZXI7XG4gICAgICAgICAgICAgICAgS2lrdS5pblJlY29yZGluZ0ZsaWdodCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgb25Db25uZWN0aW9uQ2FsbGJhY2tcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0gY29ubiA6IFBlZXJqcyBjb25uZWN0aW9uXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgb25Db25uZWN0aW9uQ2FsbGJhY2sgKGNvbm46IGFueSkge1xuICAgICAgICBjb25zb2xlLmxvZygnQ29ubmVjdGlvbiByZWNlaXZlZCEnLCBjb25uKTtcbiAgICAgICAgS2lrdS5wZWVyQ29ublN0YWNrLnB1c2goY29ubik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBvbk9wZW5DYWxsYmFja1xuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIG9uT3BlbkNhbGxiYWNrICgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0Nvbm5lY3Rpb24gb3BlbiEnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGN1cnJlbnRUaW1lXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgY3VycmVudFRpbWUgKCkgOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCArIHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgdXBkYXRlTmV0d29ya0RlbGF5VGltZVxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIHVwZGF0ZU5ldHdvcmtEZWxheVRpbWUgKCkge1xuICAgICAgICBLaWt1Lm91ck5ldHdvcmtUaW1lID0gS2lrdS5vdXJOZXR3b3JrVGltZSB8fCBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgS2lrdS50aGVpck5ldHdvcmtUaW1lID0gS2lrdS50aGVpck5ldHdvcmtUaW1lIHx8IEtpa3Uub3VyTmV0d29ya1RpbWU7XG4gICAgICAgIEtpa3UubmV0d29ya0RlbGF5VGltZSA9IE1hdGguYWJzKEtpa3Uub3VyTmV0d29ya1RpbWUgLSBLaWt1LnRoZWlyTmV0d29ya1RpbWUpLzI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB1cGRhdGVSZWNvcmRpbmdEZWxheVRpbWVcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyB1cGRhdGVSZWNvcmRpbmdEZWxheVRpbWUgKCkge1xuICAgICAgICBLaWt1LnJlY29yZGluZ0RlbGF5VGltZSA9IE1hdGguYWJzKEtpa3Uub3VyUmVjb3JkaW5nU3RhcnQgLSBLaWt1LnRoZWlyUmVjb3JkaW5nU3RhcnQpLzIwMDA7XG4gICAgfVxuXG59XG5cbi8qKlxuICogQGNsYXNzIFBlZXJDb25uZWN0aW9uXG4gKi9cbmNsYXNzIFBlZXJDb25uZWN0aW9uIHtcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgc2VuZERhdGFcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBjb25uIDogUGVlcmpzIGNvbm5lY3Rpb24gb2JqZWN0XG4gICAgICogQHBhcmFtIG1lc3NhZ2VEYXRhIDogTWVzc2FnZURhdGEgb2JqZWN0IHdpdGggZGF0YSB0byBzZW5kXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBzZW5kRGF0YSAoY29ubjogYW55LCBtZXNzYWdlRGF0YTogTWVzc2FnZURhdGEpIHtcblxuICAgICAgICBsZXQgbWVzc2FnZTogT2JqZWN0ID0ge1xuICAgICAgICAgICAgdHlwZTogbWVzc2FnZURhdGEudHlwZSxcbiAgICAgICAgICAgIHRpbWVTdGFtcDogbWVzc2FnZURhdGEudGltZVN0YW1wIHx8ICcnLFxuICAgICAgICAgICAgYXVkaW9CdWZmZXI6IG1lc3NhZ2VEYXRhLmF1ZGlvQnVmZmVyIHx8ICcnXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGNvbm4ub3Blbikge1xuICAgICAgICAgICAgY29ubi5zZW5kKG1lc3NhZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdUcmllZCB0byBzZW5kIG1lc3NhZ2Ugd2hlbiBjb25uZWN0aW9uIGlzIGNsb3NlZCEnLCBtZXNzYWdlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBAY2xhc3MgTWVzc2FnZURhdGFcbiAqL1xuY2xhc3MgTWVzc2FnZURhdGEge1xuXG4gICAgdHlwZTogc3RyaW5nO1xuICAgIHRpbWVTdGFtcD86IG51bWJlcjtcbiAgICBhdWRpb0J1ZmZlcj86IEZsb2F0MzJBcnJheTtcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSBtZXNzYWdlVHlwZSA6IE1lc3NhZ2UgdHlwZSB0byBzZW5kIG9mIHR5cGUgZW51bSBNZXNzYWdlVHlwZVxuICAgICAqIEBwYXJhbSB0aW1lU3RhbXAgOiBUaW1pbmcgaW5mb3JtYXRpb24gcmVsYXRlZCB0byB0aGUgbWVzc2FnZVxuICAgICAqIEBwYXJhbSBhdWRpb0J1ZmZlciA6IEF1ZGlvIGJ1ZmZlciB0byBzZW5kXG4gICAgICovXG4gICAgY29uc3RydWN0b3IgKG1lc3NhZ2VUeXBlOiBzdHJpbmcsIHRpbWVTdGFtcD86IG51bWJlciwgYXVkaW9CdWZmZXI/OiBGbG9hdDMyQXJyYXkpIHtcbiAgICAgICAgdGhpcy50eXBlID0gbWVzc2FnZVR5cGU7XG4gICAgICAgIHRoaXMudGltZVN0YW1wID0gdGltZVN0YW1wO1xuICAgICAgICB0aGlzLmF1ZGlvQnVmZmVyID0gYXVkaW9CdWZmZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB0b09iamVjdFxuICAgICAqIEBwdWJsaWNcbiAgICAgKi9cbiAgICBwdWJsaWMgdG9PYmplY3QgKCkgOiBPYmplY3Qge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbWVzc2FnZVR5cGU6IHRoaXMudHlwZSxcbiAgICAgICAgICAgIHRpbWVTdGFtcDogdGhpcy50aW1lU3RhbXAgfHwgW10sXG4gICAgICAgICAgICBhdWRpb0J1ZmZlcjogdGhpcy5hdWRpb0J1ZmZlciB8fCBbXVxuICAgICAgICB9O1xuICAgIH1cblxufVxuXG4vKipcbiAqIEBlbnVtIE1lc3NhZ2VUeXBlXG4gKi9cbmVudW0gTWVzc2FnZVR5cGUge1xuXG4gICAgUkVRVUVTVF9SRUNPUkQgPSAncmVxdWVzdFJlY29yZCcsXG4gICAgUkVTUE9OU0VfUkVDT1JEID0gJ3Jlc3BvbnNlUmVjb3JkJyxcblxuICAgIFNUQVJURURfUkVDT1JESU5HID0gJ3N0YXJ0ZWRSZWNvcmRpbmcnLFxuICAgIFNUT1BQRURfUkVDT1JESU5HID0gJ3N0b3BwZWRSZWNvcmRpbmcnLFxuXG4gICAgUkVRVUVTVF9FTVBUWV9SRVNQT05TRSA9ICdyZXF1ZXN0RW1wdHlSZXNwb25zZScsXG4gICAgUkVTUE9OU0VfRU1QVFlfUkVTUE9OU0UgPSAncmVzcG9uc2VFbXB0eVJlc3BvbnNlJ1xuXG59XG5cbi8vIEFzc2lnbiB0byB3aW5kb3cgZm9yIGVhc3kgSlMgc3RhcnR1cFxuKDxhbnk+d2luZG93KS5LaWt1ID0gS2lrdTtcbiIsImRlY2xhcmUgdmFyIE1lZGlhUmVjb3JkZXI6IGFueTtcblxuLyoqXG4gKiBAY2xhc3MgS2lrdUF1ZGlvU3RyZWFtXG4gKi9cbmV4cG9ydCBjbGFzcyBLaWt1QXVkaW9TdHJlYW0ge1xuXG4gICAgc3RhdGljIGlzUmVjb3JkaW5nOiBib29sZWFuID0gZmFsc2U7XG4gICAgc3RhdGljIGFjdGl2ZUJ1ZmZlcjogRmxvYXQzMkFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSgxKTtcbiAgICBzdGF0aWMgcmVjb3JkZWRCdWZmZXI6IEZsb2F0MzJBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7XG5cbiAgICBwdWJsaWMgc3RhdGljIHN0YXJ0ZWRSZWNvcmRpbmc6IEZ1bmN0aW9uID0gKCkgPT4ge307XG4gICAgcHVibGljIHN0YXRpYyBmaW5pc2hlZFJlY29yZGluZzogRnVuY3Rpb24gPSAoKSA9PiB7fTtcblxuICAgIHN0YXRpYyBhdWRpb0NvbnRleHQ6IEF1ZGlvQ29udGV4dCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcbiAgICBzdGF0aWMgc2NyaXB0Tm9kZT86IFNjcmlwdFByb2Nlc3Nvck5vZGU7XG4gICAgc3RhdGljIG1lZGlhU3RyZWFtU291cmNlTm9kZT86IE1lZGlhU3RyZWFtQXVkaW9Tb3VyY2VOb2RlO1xuXG4gICAgc3RhdGljIG1pY1JlY29yZGVyPzogTWVkaWFTdHJlYW07XG5cbiAgICBzdGF0aWMgc3VwcG9ydGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIHN0YXRpYyByZXNldEF1ZGlvQnVmZmVyOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHNldHVwXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHNldHVwICgpIHtcblxuICAgICAgICBLaWt1QXVkaW9TdHJlYW0uYXVkaW9Db250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpIHx8ICg8YW55PndpbmRvdykud2Via2l0QXVkaW9Db250ZXh0KCk7XG5cbiAgICAgICAgaWYgKG5hdmlnYXRvci5tZWRpYURldmljZXMgJiYgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpIHtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2dldFVzZXJNZWRpYSBzdXBwb3J0ZWQuJyk7XG4gICAgICAgICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSAoXG4gICAgICAgICAgICAgICA8YW55PntcbiAgICAgICAgICAgICAgICBcImF1ZGlvXCI6IHtcbiAgICAgICAgICAgICAgICAgICAgXCJtYW5kYXRvcnlcIjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJnb29nRWNob0NhbmNlbGxhdGlvblwiOiBcImZhbHNlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImdvb2dBdXRvR2FpbkNvbnRyb2xcIjogXCJmYWxzZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJnb29nTm9pc2VTdXBwcmVzc2lvblwiOiBcImZhbHNlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImdvb2dIaWdocGFzc0ZpbHRlclwiOiBcImZhbHNlXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgXCJvcHRpb25hbFwiOiBbXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgIH0pIC8vIFJlcXVlc3QgcGVybWlzc2lvbnNcbiAgICAgICAgIFxuICAgICAgICAgICAgICAgLy8gU3VjY2VzcyBjYWxsYmFja1xuICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHN0cmVhbSkge1xuICAgICAgICAgICAgICAgICAgICBLaWt1QXVkaW9TdHJlYW0uc2V0dXBTdHJlYW0oc3RyZWFtKTtcbiAgICAgICAgICAgICAgIH0pXG4gICAgICAgICBcbiAgICAgICAgICAgICAgIC8vIEVycm9yIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1RoZSBmb2xsb3dpbmcgZ2V0VXNlck1lZGlhIGVycm9yIG9jY3VyZWQ6ICcgKyBlcnIpO1xuICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgKTtcbiAgICBcbiAgICAgICAgIH0gZWxzZSB7IC8vIE1lZGlhIGRldmljZXMgd2VyZW4ndCBhdmFpbGFibGVcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignZ2V0VXNlck1lZGlhIG5vdCBzdXBwb3J0ZWQgb24geW91ciBicm93c2VyIScpO1xuICAgICAgICAgfVxuXG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGxpc3RlbkZvclN0YXJ0XG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgOiBDYWxsYmFjayB0byBjYWxsIG9uIHRoZSBzdGFydCBvZiByZWNvcmRpbmdcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGxpc3RlbkZvclN0YXJ0IChjYWxsYmFjazogRnVuY3Rpb24pIHtcbiAgICAgICAgdGhpcy5zdGFydGVkUmVjb3JkaW5nID0gY2FsbGJhY2s7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBsaXN0ZW5Gb3JFbmRcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSBjYWxsYmFjayA6IENhbGxiYWNrIHRvIGNhbGwgb24gdGhlIGVuZCBvZiByZWNvcmRpbmdcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGxpc3RlbkZvckVuZCAoY2FsbGJhY2s6IEZ1bmN0aW9uKSB7XG4gICAgICAgIHRoaXMuZmluaXNoZWRSZWNvcmRpbmcgPSBjYWxsYmFjaztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGZsb2F0MzJidWZmZXJDb25jYXRcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0gYnVmZmVyMCBcbiAgICAgKiBAcGFyYW0gYnVmZmVyMSBcbiAgICAgKi9cbiAgICBwcml2YXRlIHN0YXRpYyBmbG9hdDMyYnVmZmVyQ29uY2F0IChidWZmZXIwOiBGbG9hdDMyQXJyYXksIGJ1ZmZlcjE6IEZsb2F0MzJBcnJheSkge1xuXG4gICAgICAgIGxldCBpdGVtMExlbmd0aCA9IGJ1ZmZlcjAubGVuZ3RoO1xuICAgICAgICBsZXQgcmVzdWx0ID0gbmV3IEZsb2F0MzJBcnJheShpdGVtMExlbmd0aCArIGJ1ZmZlcjEubGVuZ3RoKTtcbiAgICBcbiAgICAgICAgcmVzdWx0LnNldChidWZmZXIwKTtcbiAgICAgICAgcmVzdWx0LnNldChidWZmZXIxLCBpdGVtMExlbmd0aCk7XG4gICAgXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHNldHVwU3RyZWFtXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHN0cmVhbSA6IE1lZGlhIHN0cmVhbSB0byBzZXR1cCBhdWRpbyByZWNvcmRpbmcgXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgc2V0dXBTdHJlYW0gKHN0cmVhbTogTWVkaWFTdHJlYW0pIHtcblxuICAgICAgICAvLyBVcGRhdGUgc3RyZWFtIGluZm9cbiAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLnN1cHBvcnRlZCA9IHRydWU7XG4gICAgICAgIHRoaXMubWljUmVjb3JkZXIgPSBuZXcgTWVkaWFSZWNvcmRlcihzdHJlYW0pO1xuXG4gICAgICAgIC8vIENyZWF0ZSBsaXZlIGF1ZGlvIGNvbnRleHQgcHJvY2Vzc2luZ1xuICAgICAgICBLaWt1QXVkaW9TdHJlYW0uc2NyaXB0Tm9kZSA9IEtpa3VBdWRpb1N0cmVhbS5hdWRpb0NvbnRleHQuY3JlYXRlU2NyaXB0UHJvY2Vzc29yKDEwMjQsIDEsIDEpO1xuICAgICAgICBLaWt1QXVkaW9TdHJlYW0ubWVkaWFTdHJlYW1Tb3VyY2VOb2RlID0gS2lrdUF1ZGlvU3RyZWFtLmF1ZGlvQ29udGV4dC5jcmVhdGVNZWRpYVN0cmVhbVNvdXJjZShzdHJlYW0pO1xuXG4gICAgICAgIC8vIENhbGxiYWNrIGZvciBzY3JpcHQgcHJvY2Vzc29yIGZ1bmN0aW9uXG4gICAgICAgIEtpa3VBdWRpb1N0cmVhbS5zY3JpcHROb2RlLm9uYXVkaW9wcm9jZXNzID0gZnVuY3Rpb24oZXZlbnQpIHtcblxuICAgICAgICAgICAgLy8gQWRkIG9udG8gcmVjb3JkZWQgZGF0YSB3aGVuIHNldCB0byB0cnVlXG4gICAgICAgICAgICBpZihLaWt1QXVkaW9TdHJlYW0uaXNSZWNvcmRpbmcpIHtcbiAgICAgICAgICAgICAgICBLaWt1QXVkaW9TdHJlYW0uYWN0aXZlQnVmZmVyID0gS2lrdUF1ZGlvU3RyZWFtLmZsb2F0MzJidWZmZXJDb25jYXQoS2lrdUF1ZGlvU3RyZWFtLmFjdGl2ZUJ1ZmZlciwgZXZlbnQuaW5wdXRCdWZmZXIuZ2V0Q2hhbm5lbERhdGEoMCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoS2lrdUF1ZGlvU3RyZWFtLnJlc2V0QXVkaW9CdWZmZXIgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgbWVtb3J5IGZvciBnYXJiYWdlIGNvbGxlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLmFjdGl2ZUJ1ZmZlciA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7XG4gICAgICAgICAgICAgICAgICAgIEtpa3VBdWRpb1N0cmVhbS5yZXNldEF1ZGlvQnVmZmVyID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQ29ubmVjdCBzb3VyY2UgdG8gc2NyaXB0IHByb2Nlc3NvclxuICAgICAgICBLaWt1QXVkaW9TdHJlYW0ubWVkaWFTdHJlYW1Tb3VyY2VOb2RlLmNvbm5lY3QoS2lrdUF1ZGlvU3RyZWFtLnNjcmlwdE5vZGUpO1xuICAgICAgICBLaWt1QXVkaW9TdHJlYW0uc2NyaXB0Tm9kZS5jb25uZWN0KEtpa3VBdWRpb1N0cmVhbS5hdWRpb0NvbnRleHQuZGVzdGluYXRpb24pO1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCByZWNvcmRBdFxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIHRpbWUgOiBUaW1lIHRvIHN0YXJ0IHJlY29yZGluZyBhdCAodW5peCB0aW1lKVxuICAgICAqIEBwYXJhbSBkdXJhdGlvbiA6IER1cmF0aW9uIHRvIHJlY29yZCBmb3IgKG1zKVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgcmVjb3JkQXQgKHRpbWU6IG51bWJlciwgZHVyYXRpb246IG51bWJlcikge1xuXG4gICAgICAgIC8vIFJlc2V0IGJ1ZmZlciBiZWZvcmUgYXR0ZW1wdGluZyB0byByZWNvcmRcbiAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLmNsZWFyQXVkaW9CdWZmZXIoKTtcblxuICAgICAgICAvLyBFc3RpbWF0ZSBleGVjdXRpb24gdGltZVxuICAgICAgICBsZXQgZXRhX21zID0gdGltZSAtIEtpa3VBdWRpb1N0cmVhbS5jdXJyZW50VGltZSgpO1xuICAgICAgICBjb25zb2xlLmxvZygnU3RhcnRpbmcgdG8gcmVjb3JkIGluICcgKyBldGFfbXMgKyAnIGZyb20gbm93ICgnICsgZXRhX21zLzEwMDAgKyAnKScpO1xuXG4gICAgICAgIC8vIERlY2xhcmUgY2FsbGJhY2sgdW50aWwgZXhlY3V0aW9uIHRpbWVcbiAgICAgICAgbGV0IHdhaXRVbnRpbCA9ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSAoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57XG4gICAgICAgICAgICAgICAgICAgIEtpa3VBdWRpb1N0cmVhbS5yZWNvcmQoZHVyYXRpb24pLnRoZW4oKHJlY29yZGluZyk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVjb3JkaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9LCBldGFfbXMpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBXYWl0IHVudGlsIGV4ZWN1dGlvbiB0aW1lXG4gICAgICAgIGxldCByZWNvcmRpbmcgPSBhd2FpdCB3YWl0VW50aWwoKTtcblxuICAgICAgICAvLyBSZXR1cm4gcmVjb3JkZWQgYnVmZmVyXG4gICAgICAgIHJldHVybiByZWNvcmRpbmc7XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHJlY29yZFxuICAgICAqIEBzdGF0aWNcbiAgICAgKiBAcHVibGljXG4gICAgICogQHBhcmFtIGR1cmF0aW9uIDogTGVuZ3RoIHRvIHJlY29yZCBmb3IgKG1zKVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcmVjb3JkIChkdXJhdGlvbjogbnVtYmVyKSB7XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlICgocmVzb2x2ZSkgPT4ge1xuXG4gICAgICAgICAgICAvLyBTZXQgcmVjb3JkIGF0b21pYyBib29sZWFuIHRydWVcbiAgICAgICAgICAgIEtpa3VBdWRpb1N0cmVhbS5pc1JlY29yZGluZyA9IHRydWU7XG5cbiAgICAgICAgICAgIC8vIE5vdGlmeSBsaXN0ZW5lcnNcbiAgICAgICAgICAgIEtpa3VBdWRpb1N0cmVhbS5zdGFydGVkUmVjb3JkaW5nKCk7XG5cbiAgICAgICAgICAgIC8vIFRpbWVvdXQgdW50aWwgZmluaXNoXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57XG4gICAgICAgICAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLmlzUmVjb3JkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgS2lrdUF1ZGlvU3RyZWFtLnJlY29yZGVkQnVmZmVyID0gS2lrdUF1ZGlvU3RyZWFtLmFjdGl2ZUJ1ZmZlcjtcbiAgICAgICAgICAgICAgICByZXNvbHZlKEtpa3VBdWRpb1N0cmVhbS5yZWNvcmRlZEJ1ZmZlcik7XG4gICAgICAgICAgICB9LCBkdXJhdGlvbik7XG5cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCByZWNvcmRpbmdcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcmVjb3JkaW5nICgpIDogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBLaWt1QXVkaW9TdHJlYW0uaXNSZWNvcmRpbmc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBnZXRMYXN0UmVjb3JkZWRCdWZmZXJcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZ2V0TGFzdFJlY29yZGVkQnVmZmVyICgpIDogRmxvYXQzMkFycmF5IHtcbiAgICAgICAgcmV0dXJuIEtpa3VBdWRpb1N0cmVhbS5yZWNvcmRlZEJ1ZmZlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGN1cnJlbnRUaW1lXG4gICAgICogQHN0YXRpY1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgY3VycmVudFRpbWUgKCkgOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCArIHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgY2xlYXJBdWRpb0J1ZmZlciAoKSB7XG4gICAgICAgIEtpa3VBdWRpb1N0cmVhbS5yZXNldEF1ZGlvQnVmZmVyID0gdHJ1ZTtcbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9